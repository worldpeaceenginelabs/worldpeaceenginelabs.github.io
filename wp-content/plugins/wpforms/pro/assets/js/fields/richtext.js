'use strict';var WPFormsRichTextField=window.WPFormsRichTextField||(function(document,window,$){var vars={mediaPostIdUpdateEvent:false,};var app={init:function(){$(document).on('wpformsReady',app.customizeRichTextField);},customizeRichTextField:function(){var $document=$(document);$document.on('tinymce-editor-setup',function(event,editor){app.addMediaButton(editor);editor.on('keyup',function(){app.validateRichTextField(editor);});});$document.on('wpformsRichTextContentChange',function(event,mutation,editor){app.validateRichTextField(editor);app.enableAddMediaButtons(mutation);});$document.on('tinymce-editor-init',function(event,editor){editor.getDoc().body.style.fontFamily=$('body').css('font-family');app.mediaPostIdUpdate();app.observeEditorChanges(editor);$document.trigger('wpformsRichTextEditorInit',[editor]);});$document.on('elementor/popup/show',function(event,id,instance){app.reInitRichTextFields(instance.$element);});$('textarea.wp-editor-area').each(function(){var $this=$(this);if($this.hasClass('wpforms-field-required')){$this.prop('required',true);}});$document.on('click','.media-modal-close, .media-modal-backdrop',app.enableAddMediaButtons);if(wp.media){wp.media.view.Modal.prototype.on('escape',function(){app.enableAddMediaButtons('escapeEvent');});}},addMediaButton:function(editor){if(wpforms_settings.richtext_add_media_button){editor.addButton('wp_add_media',{tooltip:'Add Media',icon:'dashicon dashicons-admin-media',cmd:'WP_Medialib',});}},enableAddMediaButtons:function(mutation){var isEscapeEvent=mutation==='escapeEvent';if(!isEscapeEvent&&!app.isCloseEvent(mutation)&&!app.isMutationImage(mutation)){return;}
$('.mce-btn-group button i.dashicons-admin-media').closest('.mce-btn').removeClass('mce-btn-disabled');},isCloseEvent:function(mutation){return typeof mutation.target!=='undefined'&&(mutation.target.classList.contains('media-modal-icon')||mutation.target.classList.contains('media-modal-backdrop'));},isMutationImage:function(mutation){if(typeof mutation.addedNodes==='undefined'||typeof mutation.addedNodes[0]==='undefined'){return false;}
var isMutationImage=false;mutation.addedNodes.forEach(function(node){if(node.tagName==='IMG'){isMutationImage=true;return false;}
if(node.tagName==='A'&&node.querySelector('img')){isMutationImage=true;return false;}});return isMutationImage;},disableAddMediaButtons:function(){$('.mce-btn-group button i.dashicons-admin-media').closest('.mce-btn').addClass('mce-btn-disabled');},mediaPostIdUpdate:function(){if(vars.mediaPostIdUpdateEvent){return;}
$('.wpforms-field-richtext-media-enabled .mce-toolbar .mce-btn').on('click',function(e){var $this=$(e.target);if(!$this.hasClass('dashicons-admin-media')&&$this.find('.dashicons-admin-media').length===0){return;}
var formId=$this.closest('form').data('formid'),fieldId=$this.closest('.wpforms-field-richtext').data('field-id');wp.media.model.settings.post.id='wpforms-'+formId+'-field_'+fieldId;app.disableAddMediaButtons();});vars.mediaPostIdUpdateEvent=true;},observeEditorChanges:function(editor){var observer=new MutationObserver(function(mutationsList,observer){for(var key in mutationsList){if(mutationsList[key].type==='childList'){$(document).trigger('wpformsRichTextContentChange',[mutationsList[key],editor]);}}});observer.observe(editor.iframeElement.contentWindow.document.body,{childList:true,subtree:true,attributes:true,});},validateRichTextField:function(editor){if(!editor||!$(editor.iframeElement).closest('form').data('validator')){return;}
var $textarea=$('#'+editor.id);if(editor.getContent()===$textarea.val()){return;}
editor.save();$textarea.valid();},reInitRichTextFields:function($form){$form.find('.wp-editor-area').each(function(){var id=$(this).attr('id');if(tinymce.get(id)){tinyMCE.execCommand('mceRemoveEditor',false,id);}
window.quicktags(tinyMCEPreInit.qtInit[id]);$('#'+id).css('visibility','initial');tinymce.init(tinyMCEPreInit.mceInit[id]);});},};return app;}(document,window,jQuery));WPFormsRichTextField.init();