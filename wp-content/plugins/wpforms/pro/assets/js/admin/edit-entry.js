'use strict';var WPFormsEditEntry=window.WPFormsEditEntry||(function(document,window,$){var el={$editForm:$('#wpforms-edit-entry-form'),$submitButton:$('#wpforms-edit-entry-update'),};var vars={};var app={init:function(){$(app.ready);},ready:function(){vars.nonce=el.$editForm.find('input[name="nonce"]').val();vars.entryId=el.$editForm.find('input[name="wpforms[entry_id]"]').val();app.initSavedFormData();app.events();wpf.initTooltips();},events:function(){el.$submitButton.on('click',app.clickUpdateButton);el.$editForm.on('wpformsAjaxSubmitFailed',app.submitFailed).on('wpformsAjaxSubmitSuccess',app.submitSuccess);$(window).on('beforeunload',app.beforeUnload);$(document).on('click','.wpforms-edit-entry-field-file-upload .delete',app.fileDelete);},initSavedFormData:function(){vars.savedFormData=el.$editForm.serialize();},beforeUnload:function(event){if(el.$editForm.serialize()===vars.savedFormData){return;}
event.returnValue='Leave site?';return event.returnValue;},clickUpdateButton:function(event){event.preventDefault();el.$submitButton.prop('disabled',true);app.preSubmitActions();app.hideErrors();wpforms.formSubmitAjax(el.$editForm);},preSubmitActions:function(){var formID=$('#wpforms-edit-entry-form').data('formid');$('.wpforms-smart-phone-field').trigger('input');$('.wpforms-edit-entry-field-file-upload a.disabled').each(function(){$(this).parent().remove();});$('.wpforms-field-file-upload').each(function(){var $this=$(this);if($this.is(':empty')){$this.closest('.wpforms-edit-entry-field-file-upload').addClass('empty');$this.html($('<span>',{class:'wpforms-entry-field-value',text:wpforms_admin_edit_entry.strings.entry_empty_file,}));}});$('.wpforms-field-richtext').each(function(){var fieldID=$(this).data('field-id'),editor=tinyMCE.get('wpforms-'+formID+'-field_'+fieldID);if(editor){editor.save();}});},submitFailed:function(event,response){app.displayErrors(response);$.alert({title:wpforms_admin.heads_up,content:response.data.errors.general,icon:'fa fa-info-circle',type:'orange',buttons:{confirm:{text:wpforms_admin_edit_entry.strings.continue_editing,btnClass:'btn-confirm',keys:['enter'],},cancel:{text:wpforms_admin_edit_entry.strings.view_entry,action:function(){window.location.href=wpforms_admin_edit_entry.strings.view_entry_url;},},},});},submitSuccess:function(event,response){app.initSavedFormData();if(typeof response.data==='undefined'){return;}
$('#wpforms-entry-details .wpforms-entry-modified .date-time').text(response.data.modified);$.alert({title:wpforms_admin_edit_entry.strings.success,content:wpforms_admin_edit_entry.strings.msg_saved,icon:'fa fa-info-circle',type:'green',buttons:{confirm:{text:wpforms_admin_edit_entry.strings.continue_editing,btnClass:'btn-confirm',keys:['enter'],},cancel:{text:wpforms_admin_edit_entry.strings.view_entry,action:function(){window.location.href=wpforms_admin_edit_entry.strings.view_entry_url;},},},});},hideErrors:function(){el.$editForm.find('.wpforms-field.wpforms-has-error').removeClass('wpforms-has-error');el.$editForm.find('.wpforms-error:not(label)').removeClass('wpforms-error');el.$editForm.find('label.wpforms-error').addClass('wpforms-hidden');},displayErrors:function(response){var errors=response.data&&('errors'in response.data)?response.data.errors:null;if(wpf.empty(errors)||wpf.empty(errors.field)){return;}
errors=errors.field;Object.keys(errors).forEach(function(fieldID){app.displayFieldError(fieldID,errors[fieldID]);app.displaySubfieldsErrors(fieldID,errors[fieldID]);});},displayFieldError:function(fieldID,fieldError){if(typeof fieldError!=='string'||(wpf.empty(fieldID)&&fieldID!=='0')||wpf.empty(fieldError)){return;}
var formID=el.$editForm.data('formid'),fieldInputID='wpforms-'+formID+'-field_'+fieldID,errorLabelID=fieldInputID+'-error',$fieldContainer=el.$editForm.find('#'+fieldInputID+'-container'),$errLabel=el.$editForm.find('#'+errorLabelID);$fieldContainer.addClass('wpforms-has-error');$('#'+fieldInputID).addClass('wpforms-error');if($errLabel.length>0){$errLabel.html(fieldError).removeClass('wpforms-hidden');return;}
$fieldContainer.append('<label id="'+errorLabelID+'" class="wpforms-error">'+fieldError+'</label>');},displaySubfieldsErrors:function(fieldID,fieldErrors){if(typeof fieldErrors!=='object'||wpf.empty(fieldErrors)||wpf.empty(fieldID)){return;}
var formID=el.$editForm.data('formid'),fieldInputID='wpforms-'+formID+'-field_'+fieldID,$fieldContainer=el.$editForm.find('#'+fieldInputID+'-container');Object.keys(fieldErrors).forEach(function(key){var error=fieldErrors[key];if(typeof error!=='string'||error===''){return;}
var fieldInputName='wpforms[fields]['+fieldID+']['+key+']',errorLabelID='wpforms-'+formID+'-field_'+fieldID+'-'+key+'-error',$errLabel=el.$editForm.find('#'+errorLabelID);if(!$fieldContainer.hasClass('wpforms-has-error')){$fieldContainer.addClass('wpforms-has-error');}
if($errLabel.length>0){$fieldContainer.find('[name="'+fieldInputName+'"]').addClass('wpforms-error');$errLabel.html(error).removeClass('wpforms-hidden');return;}
var errorLabel='<label id="'+errorLabelID+'" class="wpforms-error">'+error+'</label>';if($fieldContainer.hasClass('wpforms-field-likert_scale')){$fieldContainer.find('tr').eq(key.replace(/r/,'')).after(errorLabel);return;}
$fieldContainer.find('[name="'+fieldInputName+'"]').addClass('wpforms-error').after(errorLabel);});},fileDelete:function(event){event.preventDefault();var $element=$(this),$fileInput=$element.parent().find('a').first();$.confirm({title:false,content:wpforms_admin_edit_entry.strings.entry_delete_file.replace('{file_name}',$fileInput.html()),icon:'fa fa-exclamation-circle',type:'orange',buttons:{confirm:{text:wpforms_admin.ok,btnClass:'btn-confirm',keys:['enter'],action:function(){$fileInput.html($fileInput.text().strike());$fileInput.addClass('disabled');$element.parent().find('input[type="hidden"]').remove();$element.remove();},},cancel:{text:wpforms_admin.cancel,keys:['esc'],},},});},};return app;}(document,window,jQuery));WPFormsEditEntry.init();