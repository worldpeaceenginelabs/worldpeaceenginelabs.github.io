'use strict';var WPFormsDashboardWidget=window.WPFormsDashboardWidget||(function(document,window,$){var el={$widget:$('#wpforms_reports_widget_pro'),$chartTitle:$('#wpforms-dash-widget-chart-title'),$chartResetBtn:$('#wpforms-dash-widget-reset-chart'),$DaysSelect:$('#wpforms-dash-widget-timespan'),$canvas:$('#wpforms-dash-widget-chart'),$formsListBlock:$('#wpforms-dash-widget-forms-list-block'),$recomBlockDismissBtn:$('#wpforms-dash-widget-dismiss-recommended-plugin-block'),};var chart={instance:null,settings:{type:'line',data:{labels:[],datasets:[{label:wpforms_dashboard_widget.i18n.entries,data:[],backgroundColor:'rgba(255, 129, 0, 0.135)',borderColor:'rgba(211, 126, 71, 1)',borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:'rgba(255, 255, 255, 1)',}],},options:{maintainAspectRatio:false,scales:{xAxes:[{type:'time',time:{unit:'day',},distribution:'series',ticks:{beginAtZero:true,source:'labels',padding:10,minRotation:25,maxRotation:25,callback:function(value,index,values){var gap=Math.floor(values.length/7);if(gap<1){return value;}
if((values.length-index-1)%gap===0){return value;}},},}],yAxes:[{ticks:{beginAtZero:true,maxTicksLimit:6,padding:20,callback:function(value){if(Math.floor(value)===value){return value;}},},}],},elements:{line:{tension:0,},},animation:{duration:0,},hover:{animationDuration:0,},legend:{display:false,},tooltips:{displayColors:false,},responsiveAnimationDuration:0,},},init:function(){var ctx;if(!el.$canvas.length){return;}
ctx=el.$canvas[0].getContext('2d');chart.instance=new Chart(ctx,chart.settings);chart.updateUI(wpforms_dashboard_widget.chart_data);},ajaxUpdate:function(days,formId){var data={_wpnonce:wpforms_dashboard_widget.nonce,action:'wpforms_'+wpforms_dashboard_widget.slug+'_get_chart_data',days:days,form_id:formId,};app.addOverlay($(chart.instance.canvas));$.post(ajaxurl,data,function(response){chart.updateUI(response);});},updateUI:function(data){app.removeOverlay(el.$canvas);if($.isEmptyObject(data)){chart.updateWithDummyData();chart.showEmptyDataMessage();}else{chart.updateData(data);chart.removeEmptyDataMessage();}
chart.instance.data.labels=chart.settings.data.labels;chart.instance.data.datasets[0].data=chart.settings.data.datasets[0].data;chart.instance.update();},updateData:function(data){chart.settings.data.labels=[];chart.settings.data.datasets[0].data=[];$.each(data,function(index,value){var date=moment(value.day);chart.settings.data.labels.push(date);chart.settings.data.datasets[0].data.push({t:date,y:value.count,});});},updateWithDummyData:function(){chart.settings.data.labels=[];chart.settings.data.datasets[0].data=[];var end=moment().startOf('day');var days=el.$DaysSelect.val()||7;var date;var minY=5;var maxY=20;var i;for(i=1;i<=days;i++){date=end.clone().subtract(i,'days');chart.settings.data.labels.push(date);chart.settings.data.datasets[0].data.push({t:date,y:Math.floor(Math.random()*(maxY-minY+1))+minY,});}},showEmptyDataMessage:function(){chart.removeEmptyDataMessage();el.$canvas.after(wpforms_dashboard_widget.empty_chart_html);},removeEmptyDataMessage:function(){el.$canvas.siblings('.wpforms-error').remove();},events:{daysChanged:function(){var days=el.$DaysSelect.val();var formId=el.$DaysSelect.attr('data-active-form-id')||0;chart.ajaxUpdate(days,formId);app.saveWidgetMeta('timespan',days);},singleFormView:function($el){var days=el.$DaysSelect.val();var formId=$el.closest('tr').attr('data-form-id');var formTitle=$el.closest('tr').find('.wpforms-dash-widget-form-title').text();el.$DaysSelect.attr('data-active-form-id',formId);el.$chartTitle.text(formTitle);el.$chartResetBtn.show();chart.ajaxUpdate(days,formId);app.saveWidgetMeta('active_form_id',formId);},resetToGeneralView:function(){var days=el.$DaysSelect.val();el.$DaysSelect.removeAttr('data-active-form-id');el.$chartTitle.text(wpforms_dashboard_widget.i18n.total_entries);el.$chartResetBtn.hide();chart.ajaxUpdate(days,0);app.saveWidgetMeta('active_form_id',0);},},};var app={chart:chart,init:function(){$(app.ready);},ready:function(){chart.init();app.events();},events:function(){app.chartEvents();app.formsListEvents();app.miscEvents();},chartEvents:function(){el.$DaysSelect.change(function(){chart.events.daysChanged();});el.$chartResetBtn.click(function(){chart.events.resetToGeneralView();el.$formsListBlock.find('tr.wpforms-dash-widget-form-active').removeClass('wpforms-dash-widget-form-active');});},formsListEvents:function(){el.$DaysSelect.change(function(){app.updateFormsList($(this).val());});el.$widget.on('click','.wpforms-dash-widget-single-chart-btn',function(){var $t=$(this),$tr=$t.closest('tr');chart.events.singleFormView($t);$tr.closest('table').find('tr.wpforms-dash-widget-form-active').removeClass('wpforms-dash-widget-form-active');$tr.addClass('wpforms-dash-widget-form-active');});el.$formsListBlock.on('click','.wpforms-dash-widget-reset-chart',function(){el.$chartResetBtn.click();});el.$widget.on('click','#wpforms-dash-widget-forms-more',function(){app.toggleCompleteFormsList();});},miscEvents:function(){el.$recomBlockDismissBtn.click(function(){app.dismissRecommendedBlock();});},updateFormsList:function(days){var data={_wpnonce:wpforms_dashboard_widget.nonce,action:'wpforms_'+wpforms_dashboard_widget.slug+'_get_forms_list',days:days,};app.addOverlay(el.$formsListBlock.children().first());$.post(ajaxurl,data,function(response){el.$formsListBlock.html(response);app.saveWidgetMeta('timespan',days);});},toggleCompleteFormsList:function(){$('#wpforms-dash-widget-forms-list-table .wpforms-dash-widget-forms-list-hidden-el').toggle();$('#wpforms-dash-widget-forms-more').html(function(i,html){return html===wpforms_dashboard_widget.show_less_html?wpforms_dashboard_widget.show_more_html:wpforms_dashboard_widget.show_less_html;});},saveWidgetMeta:function(meta,value){var data={_wpnonce:wpforms_dashboard_widget.nonce,action:'wpforms_'+wpforms_dashboard_widget.slug+'_save_widget_meta',meta:meta,value:value,};$.post(ajaxurl,data);},addOverlay:function($el){if(!$el.parent().closest('.wpforms-dash-widget-block').length){return;}
app.removeOverlay($el);$el.after('<div class="wpforms-dash-widget-overlay"></div>');},removeOverlay:function($el){$el.siblings('.wpforms-dash-widget-overlay').remove();},dismissRecommendedBlock:function(){$('.wpforms-dash-widget-recommended-plugin-block').remove();app.saveWidgetMeta('hide_recommended_block',1);},};return app;}(document,window,jQuery));WPFormsDashboardWidget.init();