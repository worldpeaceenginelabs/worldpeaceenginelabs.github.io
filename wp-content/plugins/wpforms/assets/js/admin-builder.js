var WPFormsBuilder=window.WPFormsBuilder||(function(document,window,$){var s,$builder,elements={};var closeConfirmation=true;var adding=false;var app={settings:{spinner:'<i class="wpforms-loading-spinner"></i>',spinnerInline:'<i class="wpforms-loading-spinner wpforms-loading-inline"></i>',tinymceDefaults:{tinymce:{toolbar1:'bold,italic,underline,blockquote,strikethrough,bullist,numlist,alignleft,aligncenter,alignright,undo,redo,link'},quicktags:true},pagebreakTop:false,pagebreakBottom:false,upload_img_modal:false,},init:function(){var that=this;wpforms_panel_switch=true;s=this.settings;$(app.ready);$(window).on('load',function(){if(typeof $.ready.then==='function'){$.ready.then(app.load);}else{app.load();}});$(window).on('beforeunload',function(){if(!that.formIsSaved()&&closeConfirmation){return wpforms_builder.are_you_sure_to_close;}});},load:function(){var panel=$('#wpforms-panels-toggle .active').data('panel');if(panel==='revisions'){app.updateRevisionPreview();}
app.hideLoadingOverlay();if(wpforms_builder.template_modal_display=='1'&&'fields'===wpf.getQueryString('view')){$.alert({title:wpforms_builder.template_modal_title,content:wpforms_builder.template_modal_msg,icon:'fa fa-info-circle',type:'blue',buttons:{confirm:{text:wpforms_builder.close,btnClass:'btn-confirm',keys:['enter'],},},});}},ready:function(){if(app.isVisitedViaBackButton()){location.reload();return;}
$builder=$('#wpforms-builder');elements.$fieldOptions=$('#wpforms-field-options');elements.$sortableFieldsWrap=$('#wpforms-panel-fields .wpforms-field-wrap');elements.$noFieldsOptions=$('#wpforms-panel-fields .wpforms-no-fields-holder .no-fields');elements.$noFieldsPreview=$('#wpforms-panel-fields .wpforms-no-fields-holder .no-fields-preview');elements.$addFieldsButtons=$('.wpforms-add-fields-button').not('.not-draggable').not('.warning-modal').not('.education-modal');elements.$formPreview=$('#wpforms-panel-fields .wpforms-preview-wrap');elements.$revisionPreview=$('#wpforms-panel-revisions .wpforms-panel-content');if(app.isBuilderInPopup()){$('#wpforms-embed').remove();$('#wpforms-preview-btn').addClass('wpforms-alone');}
app.loadMsWinCSS();app.bindUIActions();var newForm=wpf.getQueryString('newform');if(newForm){app.formSave(false);}
s.formID=$('#wpforms-builder-form').data('id');s.pagebreakTop=$('.wpforms-pagebreak-top').length;s.pagebreakBottom=$('.wpforms-pagebreak-bottom').length;$builder.on('keypress','#wpforms-builder-form :input:not(textarea)',function(e){if(e.keyCode===13){e.preventDefault();}});$('.wpforms-panel').each(function(index,el){var $this=$(this),$configured=$this.find('.wpforms-panel-sidebar-section.configured').first();if($configured.length){var section=$configured.data('section');$configured.addClass('active');$this.find('.wpforms-panel-content-section-'+section).show().addClass('active');$this.find('.wpforms-panel-content-section-default').hide();}else{$this.find('.wpforms-panel-content-section:first-of-type').show().addClass('active');$this.find('.wpforms-panel-sidebar-section:first-of-type').addClass('active');}});app.loadEntryPreviewFields();app.fieldSortable();app.fieldChoiceSortable('select');app.fieldChoiceSortable('radio');app.fieldChoiceSortable('checkbox');app.fieldChoiceSortable('payment-multiple');app.fieldChoiceSortable('payment-checkbox');app.fieldChoiceSortable('payment-select');$('.wpforms-add-fields-group').each(function(index,el){app.fieldGroupToggle($(this),'load');});app.registerTemplates();app.trimFormTitle();wpf.initTooltips();app.loadColorPickers();app.captchaToggle();app.confirmationsSetup();app.notificationToggle();app.notificationsByStatusAlerts();app.builderHotkeys();$('#wpforms-setup-name').val($('#wpforms-panel-field-settings-form_title').val());jconfirm.defaults={closeIcon:false,backgroundDismiss:false,escapeKey:true,animationBounce:1,useBootstrap:false,theme:'modern',boxWidth:'400px',animateFromElement:false,content:wpforms_builder.something_went_wrong,};app.dropdownField.init();app.initSomeFieldOptions();app.dismissNotice();},loadMsWinCSS:function(){var ua=navigator.userAgent;if(ua.indexOf('Windows')<0||(ua.indexOf('Chrome')<0&&ua.indexOf('Firefox')<0)){return;}
$('<link>').appendTo('head').attr({type:'text/css',rel:'stylesheet',href:wpforms_builder.ms_win_css_url,});},isVisitedViaBackButton:function(){if(!performance){return false;}
var isVisitedViaBackButton=false;performance.getEntriesByType('navigation').forEach(function(nav){if(nav.type==='back_forward'){isVisitedViaBackButton=true;}});return isVisitedViaBackButton;},hideLoadingOverlay:function(){var $overlay=$('#wpforms-builder-overlay');$overlay.addClass('fade-out');setTimeout(function(){$overlay.hide();},250);},showLoadingOverlay:function(){var $overlay=$('#wpforms-builder-overlay');$overlay.removeClass('fade-out');$overlay.show();},initSomeFieldOptions:function(){app.toggleAllOptionGroups($builder);$builder.find('.wpforms-field-option-row-date .type select').trigger('change');},dropdownField:{config:{modernClass:'choicesjs-select',args:{searchEnabled:false,searchChoices:false,renderChoiceLimit:1,shouldSort:false,callbackOnInit:function(){var $element=$(this.containerOuter.element),$previewSelect=$element.closest('.wpforms-field').find('select');if($element.hasClass('is-disabled')){$element.removeClass('is-disabled');}
if($previewSelect.is('[readonly]')){this.disable();$previewSelect.prop('disabled',false);}
if(this.passedElement.element.multiple){if(this.getValue(true).length){$(this.input.element).addClass('choices__input--hidden');}}},},},init:function(){$builder.find('.'+app.dropdownField.config.modernClass).each(function(){app.dropdownField.events.choicesInit($(this));});$builder.on('change','.wpforms-field-option-select .wpforms-field-option-row-multiple input',app.dropdownField.events.multiple);$builder.on('change','.wpforms-field-option-select .wpforms-field-option-row-style select, .wpforms-field-option-payment-select .wpforms-field-option-row-style select',app.dropdownField.events.applyStyle);},events:{choicesInit:function($element){var instance=new Choices($element[0],app.dropdownField.config.args);app.dropdownField.helpers.setInstance($element,instance);app.dropdownField.helpers.addPlaceholderChoice($element,instance);},multiple:function(event){var fieldId=$(this).closest('.wpforms-field-option-row-multiple').data().fieldId,$primary=app.dropdownField.helpers.getPrimarySelector(fieldId),$optionChoicesItems=$('#wpforms-field-option-row-'+fieldId+'-choices input.default'),$placeholder=$primary.find('.placeholder'),isDynamicChoices=app.dropdownField.helpers.isDynamicChoices(fieldId),isMultiple=event.target.checked,choicesType=isMultiple?'checkbox':'radio',selectedChoices;$primary.prop('multiple',isMultiple);$optionChoicesItems.prop('type',choicesType);if(isDynamicChoices){$primary.find('option:selected').prop('selected',false);}
selectedChoices=$optionChoicesItems.filter(':checked');if(!isMultiple&&selectedChoices.length){$optionChoicesItems.prop('checked',false);$(selectedChoices.get(0)).prop('checked',true);}
if($placeholder.length){$placeholder.prop('selected',!isMultiple);}
app.dropdownField.helpers.update(fieldId,isDynamicChoices);},applyStyle:function(){var $field=$(this),fieldId=$field.closest('.wpforms-field-option-row-style').data().fieldId,fieldVal=$field.val();if('modern'===fieldVal){app.dropdownField.helpers.convertClassicToModern(fieldId);}else{app.dropdownField.helpers.convertModernToClassic(fieldId);}},},helpers:{convertModernToClassic:function(fieldId){var $primary=app.dropdownField.helpers.getPrimarySelector(fieldId),isDynamicChoices=app.dropdownField.helpers.isDynamicChoices(fieldId),instance=app.dropdownField.helpers.getInstance($primary);instance.destroy();app.dropdownField.helpers.updatePlaceholderChoice(instance,fieldId);if(!isDynamicChoices){app.fieldChoiceUpdate('select',fieldId);}},convertClassicToModern:function(fieldId){var $primary=app.dropdownField.helpers.getPrimarySelector(fieldId),isDynamicChoices=app.dropdownField.helpers.isDynamicChoices(fieldId);if(!isDynamicChoices){app.fieldChoiceUpdate('select',fieldId);}
app.dropdownField.events.choicesInit($primary);},update:function(fieldId,isDynamicChoices){var $primary=app.dropdownField.helpers.getPrimarySelector(fieldId);if(app.dropdownField.helpers.isModernSelect($primary)){app.dropdownField.helpers.convertModernToClassic(fieldId);app.dropdownField.events.choicesInit($primary);}else{if(!isDynamicChoices){app.fieldChoiceUpdate('select',fieldId);}}},addPlaceholderChoice:function($jquerySelector,instance){var fieldId=$jquerySelector.closest('.wpforms-field').data().fieldId,hasDefaults=app.dropdownField.helpers.hasDefaults(fieldId);if(app.dropdownField.helpers.isDynamicChoices(fieldId)){hasDefaults=false;}
if(false!==app.dropdownField.helpers.searchPlaceholderChoice(instance)){return false;}
if(!instance.config.choices.length){return false;}
var placeholder=instance.config.choices[0].label,isMultiple=$(instance.passedElement.element).prop('multiple'),selected=!(isMultiple||hasDefaults);instance.setChoices([{value:'',label:placeholder,selected:selected,placeholder:true},],'value','label',false);if(isMultiple){$(instance.input.element).prop('placeholder',placeholder);}
return true;},searchPlaceholderChoice:function(instance){var find=false;instance.config.choices.forEach(function(item,i,choices){if('undefined'!==typeof item.placeholder&&true===item.placeholder){find={key:i,item:item,};return false;}});return find;},updatePlaceholderChoice:function(instance,fieldId){var $primary=$(instance.passedElement.element),placeholderValue=wpf.sanitizeHTML($('#wpforms-field-option-'+fieldId+'-placeholder').val()),placeholderChoice=app.dropdownField.helpers.searchPlaceholderChoice(instance),$placeholderOption={};if('object'===typeof placeholderChoice){$placeholderOption=$($primary.find('option').get(placeholderChoice.key));}
if(''!==placeholderValue){if(!$.isEmptyObject($placeholderOption)&&$placeholderOption.length){$placeholderOption.addClass('placeholder').text(placeholderValue);}else{$primary.prepend('<option value="" class="placeholder">'+placeholderValue+'</option>');}}else{if($placeholderOption.length){$placeholderOption.remove();}}},isModernSelect:function($jquerySelector){var instance=app.dropdownField.helpers.getInstance($jquerySelector);if('object'!==typeof instance){return false;}
if($.isEmptyObject(instance)){return false;}
return instance.initialised;},setInstance:function($jquerySelector,instance){$jquerySelector.data('choicesjs',instance);},getInstance:function($jquerySelector){return $jquerySelector.data('choicesjs');},isDynamicChoices:function(fieldId){var $fieldOption=$('#wpforms-field-option-'+fieldId+'-dynamic_choices');if(!$fieldOption.length){return false;}
return ''!==$fieldOption.val();},hasDefaults:function(fieldId){var $choicesList=$('#wpforms-field-option-row-'+fieldId+'-choices .choices-list');return!!$choicesList.find('input.default:checked').length;},getPrimarySelector:function(fieldId){return $('#wpforms-field-'+fieldId+' .primary-input');},},},numberSliderEvents:function($builder){$builder.on('input','.wpforms-field-option-row-min_max .wpforms-input-row .wpforms-number-slider-min',app.fieldNumberSliderUpdateMin);$builder.on('input','.wpforms-field-option-row-min_max .wpforms-input-row .wpforms-number-slider-max',app.fieldNumberSliderUpdateMax);$builder.on('input','.wpforms-number-slider-default-value',_.debounce(app.changeNumberSliderDefaultValue,500));$builder.on('input','.wpforms-number-slider-step',_.debounce(app.changeNumberSliderStep,500));$builder.on('focusout','.wpforms-number-slider-step',app.checkNumberSliderStep);$builder.on('input','.wpforms-number-slider-value-display',_.debounce(app.changeNumberSliderValueDisplay,500));$builder.on('input','.wpforms-number-slider-min',_.debounce(app.changeNumberSliderMin,500));$builder.on('input','.wpforms-number-slider-max',_.debounce(app.changeNumberSliderMax,500));},changeNumberSliderMin:function(event){var fieldID=$(event.target).parents('.wpforms-field-option-row').data('fieldId');var value=parseFloat(event.target.value);if(isNaN(value)){return;}
app.updateNumberSliderDefaultValueAttr(fieldID,event.target.value,'min');},changeNumberSliderMax:function(event){var fieldID=$(event.target).parents('.wpforms-field-option-row').data('fieldId');var value=parseFloat(event.target.value);if(isNaN(value)){return;}
app.updateNumberSliderDefaultValueAttr(fieldID,event.target.value,'max').updateNumberSliderStepValueMaxAttr(fieldID,event.target.value);},changeNumberSliderValueDisplay:function(event){var str=event.target.value;var fieldID=$(event.target).parents('.wpforms-field-option-row').data('fieldId');var defaultValue=document.getElementById('wpforms-field-option-'+fieldID+'-default_value');if(defaultValue){app.updateNumberSliderHintStr(fieldID,str).updateNumberSliderHint(fieldID,defaultValue.value);}},changeNumberSliderStep:function(event){var value=parseFloat(event.target.value);if(isNaN(value)){return;}
var max=parseFloat(event.target.max);var min=parseFloat(event.target.min);var fieldID=$(event.target).parents('.wpforms-field-option-row').data('fieldId');if(value<=0){return;}
if(value>max){event.target.value=max;return;}
if(value<min){event.target.value=min;return;}
app.updateNumberSliderAttr(fieldID,value,'step').updateNumberSliderDefaultValueAttr(fieldID,value,'step');},checkNumberSliderStep:function(event){var value=parseFloat(event.target.value),$input=$(this);if(!isNaN(value)&&value>0){return;}
$.confirm({title:wpforms_builder.heads_up,content:wpforms_builder.error_number_slider_increment,icon:'fa fa-exclamation-circle',type:'orange',buttons:{confirm:{text:wpforms_builder.ok,btnClass:'btn-confirm',keys:['enter'],action:function(){$input.val('').focus();},},},});},changeNumberSliderDefaultValue:function(event){var value=parseFloat(event.target.value);if(!isNaN(value)){var max=parseFloat(event.target.max);var min=parseFloat(event.target.min);var fieldID=$(event.target).parents('.wpforms-field-option-row-default_value').data('fieldId');if(value>max){event.target.value=max;return;}
if(value<min){event.target.value=min;return;}
app.updateNumberSlider(fieldID,value).updateNumberSliderHint(fieldID,value);}},updateNumberSliderDefaultValueAttr:function(fieldID,newValue,attr){var input=document.getElementById('wpforms-field-option-'+fieldID+'-default_value');if(input){var value=parseFloat(input.value);input.setAttribute(attr,newValue);newValue=parseFloat(newValue);if('max'===attr&&value>newValue){input.value=newValue;$(input).trigger('input');}
if('min'===attr&&value<newValue){input.value=newValue;$(input).trigger('input');}}
return this;},updateNumberSlider:function(fieldID,value){var numberSlider=document.getElementById('wpforms-number-slider-'+fieldID);if(numberSlider){numberSlider.value=value;}
return this;},updateNumberSliderAttr:function(fieldID,value,attr){var numberSlider=document.getElementById('wpforms-number-slider-'+fieldID);if(numberSlider){numberSlider.setAttribute(attr,value);}
return this;},updateNumberSliderHintStr:function(fieldID,str){var hint=document.getElementById('wpforms-number-slider-hint-'+fieldID);if(hint){hint.dataset.hint=str;}
return this;},updateNumberSliderHint:function(fieldID,value){var hint=document.getElementById('wpforms-number-slider-hint-'+fieldID);if(hint){hint.innerHTML=wpf.sanitizeHTML(hint.dataset.hint).replace('{value}','<b>'+value+'</b>');}
return this;},fieldNumberSliderUpdateMin:function(event){var $options=$(event.target).parents('.wpforms-field-option-row-min_max');var max=parseFloat($options.find('.wpforms-number-slider-max').val());var current=parseFloat(event.target.value);if(isNaN(current)){return;}
if(max<=current){event.preventDefault();this.value=max;return;}
var fieldId=$options.data('field-id');var numberSlider=$builder.find('#wpforms-field-'+fieldId+' input[type="range"]');numberSlider.attr('min',current);},fieldNumberSliderUpdateMax:function(event){var $options=$(event.target).parents('.wpforms-field-option-row-min_max');var min=parseFloat($options.find('.wpforms-number-slider-min').val());var current=parseFloat(event.target.value);if(isNaN(current)){return;}
if(min>=current){event.preventDefault();this.value=min;return;}
var fieldId=$options.data('field-id');var numberSlider=$builder.find('#wpforms-field-'+fieldId+' input[type="range"]');numberSlider.attr('max',current);},updateNumberSliderStepValueMaxAttr:function(fieldID,newValue){var input=document.getElementById('wpforms-field-option-'+fieldID+'-step');if(input){var value=parseFloat(input.value);input.setAttribute('max',newValue);newValue=parseFloat(newValue);if(value>newValue){input.value=newValue;$(input).trigger('input');}}
return this;},fieldFileUploadPreviewUpdate:function(target){var $options=$(target).parents('.wpforms-field-option-file-upload');var fieldId=$options.data('field-id');var styleOption=$options.find('#wpforms-field-option-'+fieldId+'-style').val();var $maxFileNumberRow=$options.find('#wpforms-field-option-row-'+fieldId+'-max_file_number');var maxFileNumber=parseInt($maxFileNumberRow.find('input').val(),10);var $preview=$('#wpforms-field-'+fieldId);var classicPreview='.wpforms-file-upload-builder-classic';var modernPreview='.wpforms-file-upload-builder-modern';if(styleOption==='classic'){$(classicPreview,$preview).removeClass('wpforms-hide');$(modernPreview,$preview).addClass('wpforms-hide');$maxFileNumberRow.addClass('wpforms-hidden');}else{if(maxFileNumber>1){$preview.find('.modern-title').text(wpforms_builder.file_upload.preview_title_plural);$preview.find('.modern-hint').text(wpforms_builder.file_upload.preview_hint.replace('{maxFileNumber}',maxFileNumber)).removeClass('wpforms-hide');}else{$preview.find('.modern-title').text(wpforms_builder.file_upload.preview_title_single);$preview.find('.modern-hint').text(wpforms_builder.file_upload.preview_hint.replace('{maxFileNumber}',1)).addClass('wpforms-hide');}
$(classicPreview,$preview).addClass('wpforms-hide');$(modernPreview,$preview).removeClass('wpforms-hide');$maxFileNumberRow.removeClass('wpforms-hidden');}},updateTextFieldsLimitControls:function(id,checked){if(!checked){$('#wpforms-field-option-row-'+id+'-limit_controls').addClass('wpforms-hide');}else{$('#wpforms-field-option-row-'+id+'-limit_controls').removeClass('wpforms-hide');}},updatePasswordStrengthControls:function(id,checked){var $strengthControls=$('#wpforms-field-option-row-'+id+'-password-strength-level');if(checked){$strengthControls.removeClass('wpforms-hidden');}else{$strengthControls.addClass('wpforms-hidden');}},updateRichTextMediaFieldsLimitControls:function(){var $this=$(this),fieldId=$this.closest('.wpforms-field-option-row-media_enabled').data('field-id'),$mediaControls=$('#wpforms-field-option-row-'+fieldId+'-media_controls'),$toolbar=$('#wpforms-field-'+fieldId+' .wpforms-richtext-wrap .mce-toolbar-grp');if(!$this.is(':checked')){$mediaControls.hide();$toolbar.removeClass('wpforms-field-richtext-media-enabled');}else{$mediaControls.show();$toolbar.addClass('wpforms-field-richtext-media-enabled');}},updateRichTextStylePreview:function(){var $this=$(this),fieldId=$this.closest('.wpforms-field-option-row-style').data('field-id'),$toolbar=$('#wpforms-field-'+fieldId+' .wpforms-richtext-wrap .mce-toolbar-grp');$toolbar.toggleClass('wpforms-field-richtext-toolbar-basic',$this.val()!=='full');},bindUIActions:function(){app.bindUIActionsPanels();app.bindUIActionsFields();app.bindUIActionsSettings();app.bindUIActionsRevisions();app.bindUIActionsSaveExit();app.bindUIActionsGeneral();},bindUIActionsPanels:function(){$builder.on('click','#wpforms-panels-toggle button, .wpforms-panel-switch',function(e){e.preventDefault();app.panelSwitch($(this).data('panel'));});$builder.on('click','.wpforms-panel .wpforms-panel-sidebar-section',function(e){app.panelSectionSwitch(this,e);});},panelSwitch:function(panel){var $panel=$('#wpforms-panel-'+panel),$panelBtn=$('.wpforms-panel-'+panel+'-button');if(!$panel.hasClass('active')){$builder.trigger('wpformsPanelSwitch',[panel]);if(!wpforms_panel_switch){return false;}
$('#wpforms-panels-toggle').find('button').removeClass('active');$('.wpforms-panel').removeClass('active');$panelBtn.addClass('active');$panel.addClass('active');history.replaceState({},null,wpf.updateQueryString('view',panel));$builder.trigger('wpformsPanelSwitched',[panel]);}},panelSectionSwitch:function(el,e){if(e){e.preventDefault();}
var $this=$(el),$panel=$this.parent().parent(),section=$this.data('section'),$sectionButtons=$panel.find('.wpforms-panel-sidebar-section'),$sectionButton=$panel.find('.wpforms-panel-sidebar-section-'+section);if($this.hasClass('upgrade-modal')||$this.hasClass('education-modal')){return;}
if(!$sectionButton.hasClass('active')){$builder.trigger('wpformsPanelSectionSwitch',section);$sectionButtons.removeClass('active');$sectionButton.addClass('active');$panel.find('.wpforms-panel-content-section').hide();$panel.find('.wpforms-panel-content-section-'+section).show();}},bindUIActionsSetup:function(){console.warn('WARNING! Function "WPFormsBuilder.bindUIActionsSetup()" has been deprecated, please use the new "WPForms.Admin.Builder.Setup.events()" function instead!');WPForms.Admin.Builder.Setup.events();},templateSelect:function(el,e){console.warn('WARNING! Function "WPFormsBuilder.templateSelect()" has been deprecated, please use the new "WPForms.Admin.Builder.Setup.selectTemplate()" function instead!');WPForms.Admin.Builder.Setup.selectTemplate(e);},bindUIActionsFields:function(){$builder.on('click','.wpforms-tab a',function(e){e.preventDefault();app.fieldTabToggle($(this).parent().attr('id'));});$builder.on('click','.wpforms-add-fields-heading',function(e){e.preventDefault();app.fieldGroupToggle($(this),'click');});$builder.on('click','.wpforms-field',function(e){if(app.isFieldPreviewActionsDisabled(this)){return;}
app.fieldTabToggle($(this).data('field-id'));});$builder.on('mousedown click','.wpforms-field input, .wpforms-field select, .wpforms-field textarea',function(e){e.preventDefault();this.blur();});$builder.on('click','.wpforms-field-delete',function(e){e.preventDefault();e.stopPropagation();if(app.isFieldPreviewActionsDisabled(this)){return;}
app.fieldDelete($(this).parent().data('field-id'));});$builder.on('click','.wpforms-field-duplicate',function(e){e.preventDefault();e.stopPropagation();if(app.isFieldPreviewActionsDisabled(this)){return;}
app.fieldDuplicate($(this).parent().data('field-id'));});$builder.on('click','.wpforms-add-fields-button',function(e){e.preventDefault();var $field=$(this);if($field.hasClass('ui-draggable-disabled')){return;}
app.fieldAdd($field.data('field-type'));});$builder.on('wpformsFieldAdd',function(event,id,type){if(type==='select'||type==='radio'||type==='checkbox'||type==='payment-multiple'||type==='payment-checkbox'||type==='payment-select'){app.fieldChoiceSortable(type,'#wpforms-field-option-row-'+id+'-choices ul');}});$builder.on('click','.wpforms-field-option-row-choices .add',function(e){app.fieldChoiceAdd(e,$(this));});$builder.on('click','.wpforms-field-option-row-choices .remove',function(e){app.fieldChoiceDelete(e,$(this));});$builder.on('mousedown','.wpforms-field-option-row-choices input[type=radio]',function(e){var $this=$(this);if($this.is(':checked')){$this.attr('data-checked','1');}else{$this.attr('data-checked','0');}});$builder.on('click','.wpforms-field-option-row-choices input[type=radio]',function(e){var $this=$(this),list=$this.parent().parent();$this.parent().parent().find('input[type=radio]').not(this).prop('checked',false);if($this.attr('data-checked')==='1'){$this.prop('checked',false);$this.attr('data-checked','0');}
app.fieldChoiceUpdate(list.data('field-type'),list.data('field-id'));});$builder.on('change','.wpforms-field-option-row-choices input[type=checkbox]',function(e){var list=$(this).parent().parent();app.fieldChoiceUpdate(list.data('field-type'),list.data('field-id'));});$builder.on('change','.wpforms-field-option-row-show_values input',function(e){$(this).closest('.wpforms-field-option').find('.wpforms-field-option-row-choices ul').toggleClass('show-values');});$builder.on('change','.wpforms-field-option-row-choices_images input',function(){var $this=$(this),$optionRow=$this.closest('.wpforms-field-option-row'),fieldID=$optionRow.data('field-id'),$fieldOptions=$('#wpforms-field-option-'+fieldID),checked=$this.is(':checked'),type=$fieldOptions.find('.wpforms-field-option-hidden-type').val();$optionRow.find('.wpforms-alert').toggleClass('wpforms-hidden');$fieldOptions.find('.wpforms-field-option-row-choices ul').toggleClass('show-images');$fieldOptions.find('.wpforms-field-option-row-choices_images_style').toggleClass('wpforms-hidden');$fieldOptions.find('.wpforms-field-option-row-dynamic_choices').toggleClass('wpforms-hidden',checked);if(checked){$('#wpforms-field-option-'+fieldID+'-input_columns').val('inline').trigger('change');}else{$('#wpforms-field-option-'+fieldID+'-input_columns').val('').trigger('change');}
app.fieldChoiceUpdate(type,fieldID);});$builder.on('wpformsImageUploadAdd wpformsImageUploadRemove',function(event,$this,$container){var $list=$container.closest('.choices-list'),fieldID=$list.data('field-id'),type=$list.data('field-type');app.fieldChoiceUpdate(type,fieldID);});$builder.on('change','.wpforms-field-option-row-choices_images_style select',function(){var fieldID=$(this).parent().data('field-id'),type=$('#wpforms-field-option-'+fieldID).find('.wpforms-field-option-hidden-type').val();app.fieldChoiceUpdate(type,fieldID);});$builder.on('keyup','.wpforms-field-option-row-choices input.label, .wpforms-field-option-row-choices input.value',function(e){var $list=$(this).parent().parent();app.fieldChoiceUpdate($list.data('field-type'),$list.data('field-id'));});$builder.on('click','.toggle-bulk-add-display',function(e){e.preventDefault();app.fieldChoiceBulkAddToggle(this);});$builder.on('click','.toggle-bulk-add-presets',function(e){e.preventDefault();var $presetList=$(this).closest('.bulk-add-display').find('ul');if($presetList.css('display')==='block'){$(this).text(wpforms_builder.bulk_add_presets_show);}else{$(this).text(wpforms_builder.bulk_add_presets_hide);}
$presetList.stop().slideToggle();});$builder.on('click','.bulk-add-preset-insert',function(e){e.preventDefault();var $this=$(this),preset=$this.data('preset'),$container=$this.closest('.bulk-add-display'),$presetList=$container.find('ul'),$presetToggle=$container.find('.toggle-bulk-add-presets'),$textarea=$container.find('textarea');$textarea.val('');$textarea.insertAtCaret(wpforms_preset_choices[preset].choices.join("\n"));$presetToggle.text(wpforms_builder.bulk_add_presets_show);$presetList.slideUp();});$builder.on('click','.bulk-add-insert',function(e){e.preventDefault();app.fieldChoiceBulkAddInsert(this);});$builder.on('click','.wpforms-field-option-group-toggle:not(.education-modal)',function(e){e.preventDefault();var $group=$(this).closest('.wpforms-field-option-group');$group.siblings('.wpforms-field-option-group').removeClass('active');$group.addClass('active');});$builder.on('change','.wpforms-field-option-address input.wpforms-subfield-hide',function(e){var $optionRow=$(this).closest('.wpforms-field-option-row'),id=$optionRow.data('field-id'),subfield=$optionRow.data('subfield');$('#wpforms-field-'+id).find('.wpforms-'+subfield).toggleClass('wpforms-hide');});$builder.on('input','.wpforms-field-option-row-label input, .wpforms-field-option-row-name input',function(e){var $this=$(this),value=$this.val(),id=$this.parent().data('field-id'),$preview=$('#wpforms-field-'+id),type=$preview.data('field-type'),showClass=value.length===0;if(type==='html'){showClass=false;}
if(showClass){value=wpforms_builder.empty_label;}
$preview.toggleClass('label_empty',showClass).find('.label-title .text').text(value);});$builder.on('input','.wpforms-field-option-row-description textarea',function(){var $this=$(this),value=wpf.sanitizeHTML($this.val()),id=$this.parent().data('field-id'),$desc=$('#wpforms-field-'+id).find('.description');app.updateDescription($desc,value);});$builder.on('change','.wpforms-field-option-row-required input',function(e){var id=$(this).closest('.wpforms-field-option-row').data('field-id');$('#wpforms-field-'+id).toggleClass('required');});$builder.on('change','.wpforms-field-option-row-confirmation input',function(e){var id=$(this).closest('.wpforms-field-option-row').data('field-id');$('#wpforms-field-'+id).find('.wpforms-confirm').toggleClass('wpforms-confirm-enabled wpforms-confirm-disabled');$('#wpforms-field-option-'+id).toggleClass('wpforms-confirm-enabled wpforms-confirm-disabled');});$builder.on('change','.wpforms-field-option-row-filter_type select',function(){var id=$(this).parent().data('field-id'),$toggledField=$('#wpforms-field-option-'+id);if($(this).val()){$toggledField.removeClass('wpforms-filter-allowlist');$toggledField.removeClass('wpforms-filter-denylist');$toggledField.addClass('wpforms-filter-'+$(this).val());}else{$toggledField.removeClass('wpforms-filter-allowlist');$toggledField.removeClass('wpforms-filter-denylist');}});$builder.on('focusout','.wpforms-field-option-row-allowlist textarea,.wpforms-field-option-row-denylist textarea',function(){var $field=$(this);$.get(wpforms_builder.ajax_url,{nonce:wpforms_builder.nonce,content:$field.val(),action:'wpforms_sanitize_restricted_rules',},function(res){if(res.success){$field.val(res.data);}});});$builder.on('change','.wpforms-field-option-row-size select',function(e){var $this=$(this),value=$this.val(),id=$this.parent().data('field-id');$('#wpforms-field-'+id).removeClass('size-small size-medium size-large').addClass('size-'+value);});$builder.on('input','.wpforms-field-option-row-placeholder input',function(){var $this=$(this),value=wpf.sanitizeHTML($this.val()),id=$this.parent().data('field-id'),$primary=$('#wpforms-field-'+id+' .primary-input');if(!$primary.is('select')){$primary.prop('placeholder',value);return;}
if(app.dropdownField.helpers.isModernSelect($primary)){var choicejsInstance=app.dropdownField.helpers.getInstance($primary);if($primary.prop('multiple')){$(choicejsInstance.input.element).prop('placeholder',value);}else{choicejsInstance.setChoiceByValue('');$primary.closest('.choices').find('.choices__inner .choices__placeholder').text(value);var isDynamicChoices=$('#wpforms-field-option-'+id+'-dynamic_choices').val();app.dropdownField.helpers.update(id,isDynamicChoices);}
return;}
var $placeholder=$primary.find('.placeholder');if(!value.length&&$placeholder.length){$placeholder.remove();}else{if($placeholder.length){$placeholder.text(value);}else{$primary.prepend('<option value="" class="placeholder">'+value+'</option>');}
$primary.find('.placeholder').prop('selected',!$primary.prop('multiple'));}});$builder.on('input','.wpforms-field-option-row-confirmation_placeholder input',function(e){var $this=$(this),value=$this.val(),id=$this.parent().data('field-id');$('#wpforms-field-'+id).find('.secondary-input').attr('placeholder',value);});$builder.on('change','.wpforms-field-option-row-label_hide input',function(e){var id=$(this).closest('.wpforms-field-option-row').data('field-id');$('#wpforms-field-'+id).toggleClass('label_hide');});$builder.on('change','.wpforms-field-option-row-sublabel_hide input',function(e){var id=$(this).closest('.wpforms-field-option-row').data('field-id');$('#wpforms-field-'+id).toggleClass('sublabel_hide');});$builder.on('change','.wpforms-field-option-row-format select',function(){var $this=$(this),value=$this.val(),id=$this.parent().data('field-id'),$sublabelToggle=$('#wpforms-field-option-row-'+id+'-sublabel_hide');$('#wpforms-field-'+id).find('.format-selected').removeClass().addClass('format-selected format-selected-'+value);$('#wpforms-field-option-'+id).find('.format-selected').removeClass().addClass('format-selected format-selected-'+value);if(['date-time','first-last','first-middle-last'].includes(value)){$sublabelToggle.removeClass('wpforms-hidden');}else{$sublabelToggle.addClass('wpforms-hidden');}});$builder.on('change','.wpforms-field-option-row-scheme select',function(e){var $this=$(this),value=$this.val(),id=$this.parent().data('field-id'),$field=$('#wpforms-field-'+id);$field.find('.wpforms-address-scheme').addClass('wpforms-hide');$field.find('.wpforms-address-scheme-'+value).removeClass('wpforms-hide');if($field.find('.wpforms-address-scheme-'+value+' .wpforms-country').children().length==0){$('#wpforms-field-option-'+id).find('.wpforms-field-option-row-country').addClass('wpforms-hidden');}else{$('#wpforms-field-option-'+id).find('.wpforms-field-option-row-country').removeClass('wpforms-hidden');}});$builder.on('input','.wpforms-field-option .format-selected input.placeholder, .wpforms-field-option-address input.placeholder',function(e){var $this=$(this),value=$this.val(),$fieldOptionRow=$this.closest('.wpforms-field-option-row'),id=$fieldOptionRow.data('field-id'),subfield=$fieldOptionRow.data('subfield');$('#wpforms-field-'+id).find('.wpforms-'+subfield+' input').attr('placeholder',value);});$builder.on('change','.wpforms-field-option-row-date .type select',function(e){var $this=$(this),value=$this.val(),id=$(this).closest('.wpforms-field-option-row').data('field-id'),addClass=value==='datepicker'?'wpforms-date-type-datepicker':'wpforms-date-type-dropdown',removeClass=value==='datepicker'?'wpforms-date-type-dropdown':'wpforms-date-type-datepicker';$('#wpforms-field-'+id).find('.wpforms-date').addClass(addClass).removeClass(removeClass);$('#wpforms-field-option-'+id).addClass(addClass).removeClass(removeClass);var $limitDays=$this.closest('.wpforms-field-option-group-advanced').find('.wpforms-field-option-row-date_limit_days, .wpforms-field-option-row-date_limit_days_options, .wpforms-field-option-row-date_disable_past_dates'),$limitDaysOptions=$('#wpforms-field-option-row-'+id+'-date_limit_days_options');if(value==='dropdown'){var $dateSelect=$('#wpforms-field-option-'+id+'-date_format');if($dateSelect.find('option:selected').hasClass('datepicker-only')){$dateSelect.prop('selectedIndex',0).trigger('change');}
$limitDays.hide();}else{$limitDays.show();$('#wpforms-field-option-'+id+'-date_limit_days').is(':checked')?$limitDaysOptions.show():$limitDaysOptions.hide();}});$builder.on('change','.wpforms-field-option-row-date .format select',function(e){var $this=$(this),value=$this.val(),id=$(this).closest('.wpforms-field-option-row').data('field-id'),$field=$('#wpforms-field-'+id);if(value==='m/d/Y'){$field.find('.wpforms-date-dropdown .first option').text(wpforms_builder.date_select_month);$field.find('.wpforms-date-dropdown .second option').text(wpforms_builder.date_select_day);}else if(value==='d/m/Y'){$field.find('.wpforms-date-dropdown .first option').text(wpforms_builder.date_select_day);$field.find('.wpforms-date-dropdown .second option').text(wpforms_builder.date_select_month);}});$builder.on('change','.wpforms-field-option-row-time .format select',function(e){var $this=$(this),id=$(this).closest('.wpforms-field-option-row').data('field-id'),options='',hh;var format=$this.val().match(/[gh]/)?12:24;for(var i=0;i<format;i++){hh=i<10?'0'+i:i;options+='<option value="{hh}">{hh}</option>'.replace(/{hh}/g,hh);}
_.forEach(['start','end'],function(field){var $hour=$builder.find('#wpforms-field-option-'+id+'-time_limit_hours_'+field+'_hour'),$ampm=$builder.find('#wpforms-field-option-'+id+'-time_limit_hours_'+field+'_ampm'),hourValue=parseInt($hour.val(),10),ampmValue=$ampm.val();if(format===24){hourValue=ampmValue==='pm'?hourValue+12:hourValue;}else{ampmValue=hourValue>12?'pm':'am';hourValue=hourValue>12?hourValue-12:hourValue;}
hourValue=hourValue<10?'0'+hourValue:hourValue;$hour.html(options).val(hourValue);$ampm.toggleClass('wpforms-hidden-strict',format===24).val(ampmValue);$ampm.nextAll('div').toggleClass('wpforms-hidden-strict',format===12);});});$builder.on('click','.wpforms-pagebreak-button',function(e){e.preventDefault();$(this).closest('.wpforms-field').trigger('click');});app.fieldPageBreakInitDisplayPrevious($builder.find('.wpforms-field-pagebreak.wpforms-pagebreak-normal:first'));$builder.on('input','.wpforms-field-option-row-next input',function(e){var $this=$(this),value=$this.val(),$next=$('#wpforms-field-'+$this.parent().data('field-id')).find('.wpforms-pagebreak-next');if(value){$next.css('display','inline-block').text(value);}else{$next.css('display','none').empty();}}).on('input','.wpforms-field-option-row-prev input',function(e){var $this=$(this),value=$this.val().trim(),$field=$('#wpforms-field-'+$this.parent().data('field-id')),$prevBtn=$field.find('.wpforms-pagebreak-prev');if(value&&$field.prevAll('.wpforms-field-pagebreak.wpforms-pagebreak-normal').length>0){$prevBtn.removeClass('wpforms-hidden').text(value);}else{$prevBtn.addClass('wpforms-hidden').empty();}}).on('change','.wpforms-field-option-row-prev_toggle input',function(e){var $input=$(this),$wrapper=$input.closest('.wpforms-field-option-row-prev_toggle'),$prev=$input.closest('.wpforms-field-option-group-inner').find('.wpforms-field-option-row-prev'),$prevLabel=$prev.find('input'),$prevBtn=$('#wpforms-field-'+$input.closest('.wpforms-field-option').data('field-id')).find('.wpforms-pagebreak-prev');if($wrapper.hasClass('wpforms-entry-preview-block')){return;}
$prev.toggleClass('wpforms-hidden',!$input.prop('checked'));$prevBtn.toggleClass('wpforms-hidden',!$input.prop('checked'));if($input.prop('checked')&&!$prevLabel.val()){var message=$prevLabel.data('last-value');message=message&&message.trim()?message.trim():wpforms_builder.previous;$prevLabel.val(message);}
if(!$input.prop('checked')){$prevLabel.data('last-value',$prevLabel.val());$prevLabel.val('');}
$prevLabel.trigger('input');}).on('wpformsFieldAdd',app.fieldPagebreakAdd).on('wpformsFieldDelete',app.fieldPagebreakDelete).on('wpformsBeforeFieldDelete',app.fieldEntryPreviewDelete);$builder.on('wpformsFieldMove wpformsFieldAdd wpformsFieldDelete',function(e){$builder.find('.wpforms-field-pagebreak.wpforms-pagebreak-normal').each(function(i){app.fieldPageBreakInitDisplayPrevious($(this));});});$builder.on('input','.wpforms-field-option-row-title input',function(e){var $this=$(this),value=$this.val(),id=$this.parent().data('field-id');if(value){$('#wpforms-field-'+id).find('.wpforms-pagebreak-title').text('('+value+')');}else{$('#wpforms-field-'+id).find('.wpforms-pagebreak-title').empty();}});$builder.on('change','.wpforms-field-option-row-nav_align select',function(e){var $this=$(this),value=$this.val();if(!value){value='center';}
$('.wpforms-pagebreak-buttons').removeClass('wpforms-pagebreak-buttons-center wpforms-pagebreak-buttons-left wpforms-pagebreak-buttons-right wpforms-pagebreak-buttons-split').addClass('wpforms-pagebreak-buttons-'+value);});$builder.on('input','.wpforms-field-option-row-price input',function(e){var $this=$(this),value=$this.val(),id=$this.parent().data('field-id'),sanitized=wpf.amountSanitize(value),formatted=wpf.amountFormat(sanitized),singleItem;if(wpforms_builder.currency_symbol_pos==='right'){singleItem=formatted+' '+wpforms_builder.currency_symbol;}else{singleItem=wpforms_builder.currency_symbol+' '+formatted;}
$('#wpforms-field-'+id).find('.primary-input').val(formatted);$('#wpforms-field-'+id).find('.price').text(singleItem);});$builder.on('change','.wpforms-field-option-credit-card .payment-icons input',function(e){var $this=$(this),card=$this.data('card'),id=$this.parent().data('field-id');$('#wpforms-field-'+id).find('img.icon-'+card).toggleClass('card_hide');});$builder.on('input','.wpforms-field-option input.placeholder-update',function(e){var $this=$(this),value=$this.val(),id=$this.data('field-id'),subfield=$this.data('subfield');$('#wpforms-field-'+id).find('.wpforms-'+subfield+' input').attr('placeholder',value);});$builder.on('change','.wpforms-field-option-row-input_columns select',function(){var $this=$(this),value=$this.val(),cls='',id=$this.parent().data('field-id');if(value==='2'){cls='wpforms-list-2-columns';}else if(value==='3'){cls='wpforms-list-3-columns';}else if(value==='inline'){cls='wpforms-list-inline';}
$('#wpforms-field-'+id).removeClass('wpforms-list-2-columns wpforms-list-3-columns wpforms-list-inline').addClass(cls);});$builder.on('change','.wpforms-field-option-row .wpforms-toggle-control input',function(e){var $check=$(this),$control=$check.closest('.wpforms-toggle-control'),$status=$control.find('.wpforms-toggle-control-status'),state=$check.is(':checked')?'on':'off';$status.html($status.data(state));});$builder.on('change','.wpforms-field-option-row-dynamic_choices select',function(e){app.fieldDynamicChoiceToggle($(this));});$builder.on('change','.wpforms-field-option-row-dynamic_taxonomy select, .wpforms-field-option-row-dynamic_post_type select',function(e){app.fieldDynamicChoiceSource($(this));});$builder.on('click','.toggle-layout-selector-display',function(e){e.preventDefault();app.fieldLayoutSelectorToggle(this);});$builder.on('click','.layout-selector-display-layout',function(e){e.preventDefault();app.fieldLayoutSelectorLayout(this);});$builder.on('click','.layout-selector-display-columns span',function(e){e.preventDefault();app.fieldLayoutSelectorInsert(this);});$(document).on('change','.wpforms-field-option-row-scale select',function(){var $this=$(this),value=$this.val(),id=$this.parent().data('field-id'),$icons=$('#wpforms-field-'+id+' .rating-icon'),x=1;$icons.each(function(index){if(x<=value){$(this).show();}else{$(this).hide();}
x++;});});$(document).on('change','.wpforms-field-option-row-icon select',function(){var $this=$(this),value=$this.val(),id=$this.parent().data('field-id'),$icons=$('#wpforms-field-'+id+' .rating-icon'),iconClass='fa-star';if('heart'===value){iconClass='fa-heart';}else if('thumb'===value){iconClass='fa-thumbs-up';}else if('smiley'===value){iconClass='fa-smile-o';}
$icons.removeClass('fa-star fa-heart fa-thumbs-up fa-smile-o').addClass(iconClass);});$(document).on('change','.wpforms-field-option-row-icon_size select',function(){var $this=$(this),value=$this.val(),id=$this.parent().data('field-id'),$icons=$('#wpforms-field-'+id+' .rating-icon');fontSize='28';if('small'===value){fontSize='18';}else if('large'===value){fontSize='38';}
$icons.css('font-size',fontSize+'px');});$(document).on('input','.wpforms-field-option-row-icon_color input.wpforms-color-picker',function(){var $this=$(this),value=$this.val(),id=$this.closest('.wpforms-field-option-row').data('field-id'),$icons=$('#wpforms-field-'+id+' > i.fa');$icons.css('color',value);});$(document).on('change','.wpforms-field-option-row-disclaimer_format input',function(){var $this=$(this),id=$this.closest('.wpforms-field-option-row').data('field-id'),$desc=$('#wpforms-field-'+id+' .description');$desc.toggleClass('disclaimer');});$builder.on('change','.wpforms-field-option-row-limit_enabled input',function(event){app.updateTextFieldsLimitControls($(event.target).closest('.wpforms-field-option-row-limit_enabled').data().fieldId,event.target.checked);});$builder.on('change','.wpforms-field-option-row-password-strength input',function(event){app.updatePasswordStrengthControls($(event.target).parents('.wpforms-field-option-row-password-strength').data().fieldId,event.target.checked);});$builder.on('change','.wpforms-field-option-richtext .wpforms-field-option-row-media_enabled input',app.updateRichTextMediaFieldsLimitControls);$builder.on('change','.wpforms-field-option-richtext .wpforms-field-option-row-style select',app.updateRichTextStylePreview);$builder.on('change','.wpforms-field-option-file-upload .wpforms-field-option-row-style select, .wpforms-field-option-file-upload .wpforms-field-option-row-max_file_number input',function(event){app.fieldFileUploadPreviewUpdate(event.target);});app.numberSliderEvents($builder);app.fieldDynamicChoiceToggleImageChoices();$builder.on('change','.wpforms-field-option-row-show_price_after_labels input',function(e){var $input=$(this),$list=$input.closest('.wpforms-field-option-group-basic').find('.wpforms-field-option-row-choices .choices-list');app.fieldChoiceUpdate($list.data('field-type'),$list.data('field-id'));});$builder.on('input','.wpforms-field-option-row-preview-notice textarea',app.updatePreviewNotice).on('change','.wpforms-field-option-row-preview-notice-enable input',app.toggleEntryPreviewNotice).on('wpformsFieldAdd',app.maybeLockEntryPreviewGroupOnAdd).on('wpformsFieldMove',app.maybeLockEntryPreviewGroupOnMove).on('click','.wpforms-entry-preview-block',app.entryPreviewBlockField);app.defaultStateEntryPreviewNotice();},isFieldPreviewActionsDisabled:function(el){return $(el).closest('.wpforms-field-wrap').hasClass('ui-sortable-disabled');},fieldGroupToggle:function(el,action){var $this=$(el),$buttons=$this.next('.wpforms-add-fields-buttons'),$group=$buttons.parent(),$icon=$this.find('i'),groupName=$this.data('group'),cookieName='wpforms_field_group_'+groupName;if(action==='click'){if($group.hasClass('wpforms-closed')){wpCookies.remove(cookieName);}else{wpCookies.set(cookieName,'true',2592000);}
$icon.toggleClass('wpforms-angle-right');$buttons.stop().slideToggle('',function(){$group.toggleClass('wpforms-closed');});return;}
if(action==='load'){$buttons=$this.find('.wpforms-add-fields-buttons');$icon=$this.find('.wpforms-add-fields-heading i');groupName=$this.find('.wpforms-add-fields-heading').data('group');cookieName='wpforms_field_group_'+groupName;if(wpCookies.get(cookieName)==='true'){$icon.toggleClass('wpforms-angle-right');$buttons.hide();$this.toggleClass('wpforms-closed');}}},updateDescription:function($el,value){if($el.hasClass('nl2br')){value=value.replace(/\n/g,'<br>');}
$el.html(value);},defaultStateEntryPreviewNotice:function(){$('.wpforms-field-option-row-preview-notice-enable input').each(function(){$(this).trigger('change');});},updatePreviewNotice:function(){var $this=$(this),value=wpf.sanitizeHTML($this.val()).trim(),id=$this.parent().data('field-id'),$field=$('#wpforms-field-'+id).find('.wpforms-entry-preview-notice');value=value?value:wpforms_builder.entry_preview_default_notice;app.updateDescription($field,value);},toggleEntryPreviewNotice:function(){var $this=$(this),id=$this.closest('.wpforms-field-option').data('field-id'),$field=$('#wpforms-field-'+id),$noticeField=$('#wpforms-field-option-'+id+' .wpforms-field-option-row-preview-notice'),$notice=$field.find('.wpforms-entry-preview-notice'),$defaultNotice=$field.find('.wpforms-alert-info');if($this.is(':checked')){$defaultNotice.hide();$notice.show();$noticeField.show();return;}
$noticeField.hide();$notice.hide();$defaultNotice.show();},fieldDelete:function(id){var $field=$('#wpforms-field-'+id),type=$field.data('field-type');if(type==='pagebreak'&&$field.hasClass('wpforms-field-entry-preview-not-deleted')){app.youCantRemovePageBreakFieldPopup();return;}
if($field.hasClass('no-delete')){app.youCantRemoveFieldPopup();return;}
app.confirmFieldDeletion(id,type);},youCantRemovePageBreakFieldPopup:function(){$.alert({title:wpforms_builder.heads_up,content:wpforms_builder.entry_preview_require_page_break,icon:'fa fa-exclamation-circle',type:'red',buttons:{confirm:{text:wpforms_builder.ok,btnClass:'btn-confirm',keys:['enter'],},},});},youCantReorderFieldPopup:function(){$.confirm({title:wpforms_builder.heads_up,content:wpforms_builder.field_cannot_be_reordered,icon:'fa fa-exclamation-circle',type:'red',buttons:{confirm:{text:wpforms_builder.ok,btnClass:'btn-confirm',keys:['enter'],},},});},youCantRemoveFieldPopup:function(){$.alert({title:wpforms_builder.field_locked,content:wpforms_builder.field_locked_no_delete_msg,icon:'fa fa-info-circle',type:'blue',buttons:{confirm:{text:wpforms_builder.close,btnClass:'btn-confirm',keys:['enter'],},},});},confirmFieldDeletion:function(id,type){var fieldData={'id':id,'message':wpforms_builder.delete_confirm,};$builder.trigger('wpformsBeforeFieldDeleteAlert',[fieldData]);$.confirm({title:false,content:fieldData.message,icon:'fa fa-exclamation-circle',type:'orange',buttons:{confirm:{text:wpforms_builder.ok,btnClass:'btn-confirm',keys:['enter'],action:function(){app.fieldDeleteById(id,type);},},cancel:{text:wpforms_builder.cancel,},},});},fieldDeleteById:function(id,type){$('#wpforms-field-'+id).fadeOut(400,function(){$builder.trigger('wpformsBeforeFieldDelete',[id,type]);$(this).remove();$('#wpforms-field-option-'+id).remove();$('.wpforms-field, .wpforms-title-desc').removeClass('active');app.fieldTabToggle('add-fields');if($('.wpforms-field').length<1){elements.$fieldOptions.append(elements.$noFieldsOptions.clone());elements.$sortableFieldsWrap.append(elements.$noFieldsPreview.clone());$builder.find('.wpforms-field-submit').hide();}
$builder.trigger('wpformsFieldDelete',[id,type]);});},loadEntryPreviewFields:function(){var $fields=$('.wpforms-field-wrap .wpforms-field-entry-preview');if(!$fields.length){return;}
$fields.each(function(){app.lockEntryPreviewFieldsPosition($(this).data('field-id'));});},fieldEntryPreviewDelete:function(event,id,type){if('entry-preview'!==type){return;}
var $field=$('#wpforms-field-'+id),$previousPageBreakField=$field.prevAll('.wpforms-field-pagebreak').first(),$nextPageBreakField=$field.nextAll('.wpforms-field-pagebreak').first(),nextPageBreakId=$nextPageBreakField.data('field-id'),$nextPageBreakOptions=$('#wpforms-field-option-'+nextPageBreakId);$previousPageBreakField.removeClass('wpforms-field-not-draggable wpforms-field-entry-preview-not-deleted');$nextPageBreakOptions.find('.wpforms-entry-preview-block').removeClass('wpforms-entry-preview-block');},maybeLockEntryPreviewGroupOnMove:function(e,ui){if(!ui.item.hasClass('wpforms-field-pagebreak')){return;}
app.maybeLockEntryPreviewGroupOnAdd(e,ui.item.data('field-id'),'pagebreak');},maybeLockEntryPreviewGroupOnAdd:function(e,fieldId,type){if(type!=='pagebreak'){return;}
var $currentField=$('#wpforms-field-'+fieldId),$currentFieldPrevToggle=$('#wpforms-field-option-'+fieldId+' .wpforms-field-option-row-prev_toggle'),$currentFieldPrevToggleField=$currentFieldPrevToggle.find('input'),$prevField=$currentField.prevAll('.wpforms-field-entry-preview,.wpforms-field-pagebreak').first(),$prevFieldPrevToggle=$('#wpforms-field-option-'+$prevField.data('field-id')+' .wpforms-field-option-row-prev_toggle'),$prevFieldPrevToggleField=$prevFieldPrevToggle.find('input'),$nextField=$currentField.nextAll('.wpforms-field-entry-preview,.wpforms-field-pagebreak').first(),$nextFieldPrevToggle=$('#wpforms-field-option-'+$nextField.data('field-id')+' .wpforms-field-option-row-prev_toggle');if(!$prevField.hasClass('wpforms-field-entry-preview')&&!$nextField.hasClass('wpforms-field-entry-preview')){return;}
if($prevField.hasClass('wpforms-field-entry-preview')){$currentFieldPrevToggleField.attr('checked','checked').trigger('change');$currentFieldPrevToggle.addClass('wpforms-entry-preview-block');$nextFieldPrevToggle.removeClass('wpforms-entry-preview-block');return;}
$currentField.addClass('wpforms-field-not-draggable wpforms-field-entry-preview-not-deleted');$prevField.removeClass('wpforms-field-not-draggable wpforms-field-entry-preview-not-deleted');if($prevField.prevAll('.wpforms-field-entry-preview,.wpforms-field-pagebreak').first().hasClass('wpforms-field-entry-preview')){$prevFieldPrevToggleField.attr('checked','checked').trigger('change');$prevFieldPrevToggle.addClass('wpforms-entry-preview-block');}},entryPreviewBlockField:function(e){e.preventDefault();$.alert({title:wpforms_builder.heads_up,content:wpforms_builder.entry_preview_require_previous_button,icon:'fa fa-exclamation-circle',type:'red',buttons:{confirm:{text:wpforms_builder.ok,btnClass:'btn-confirm',keys:['enter'],},},});},isUncheckedEntryPreviewField:function(type,options){return type==='entry-preview'&&(!options||options&&!options.passed);},addEntryPreviewField:function(type,options){var addButton=$('#wpforms-add-fields-entry-preview');if(addButton.hasClass('wpforms-entry-preview-adding')){return;}
var $fields=$('.wpforms-field-wrap .wpforms-field'),position=options&&options.position?options.position:$fields.length,needPageBreakBefore=app.isEntryPreviewFieldRequiresPageBreakBefore($fields,position),needPageBreakAfter=app.isEntryPreviewFieldRequiresPageBreakAfter($fields,position);addButton.addClass('wpforms-entry-preview-adding');if(!options){options={};}
options.passed=true;if(!needPageBreakBefore&&!needPageBreakAfter){app.fieldAdd('entry-preview',options).done(function(res){app.lockEntryPreviewFieldsPosition(res.data.field.id);});return;}
if(needPageBreakBefore){app.addPageBreakAndEntryPreviewFields(options,position);return;}
app.addEntryPreviewAndPageBreakFields(options,position);},addEntryPreviewFieldAfterPageBreak:function(options){var checkExist=setInterval(function(){if($('.wpforms-field-wrap .wpforms-pagebreak-bottom, .wpforms-field-wrap .wpforms-pagebreak-top').length===2){app.fieldAdd('entry-preview',options).done(function(res){app.lockEntryPreviewFieldsPosition(res.data.field.id);});clearInterval(checkExist);}},100);},addPageBreakAndEntryPreviewFields:function(options,position){var hasPageBreak=$('.wpforms-field-wrap .wpforms-field-pagebreak').length>=3;app.fieldAdd('pagebreak',{'position':position}).done(function(res){options.position=hasPageBreak?position+1:position+2;app.addEntryPreviewFieldAfterPageBreak(options);var $pageBreakOptions=$('#wpforms-field-option-'+res.data.field.id),$pageBreakPrevToggle=$pageBreakOptions.find('.wpforms-field-option-row-prev_toggle'),$pageBreakPrevToggleField=$pageBreakPrevToggle.find('input');$pageBreakPrevToggleField.attr('checked','checked').trigger('change');$pageBreakPrevToggle.addClass('wpforms-entry-preview-block');});},fieldDuplicate:function(id){var $field=$('#wpforms-field-'+id),type=$field.data('field-type');if($field.hasClass('no-duplicate')){$.alert({title:wpforms_builder.field_locked,content:wpforms_builder.field_locked_no_duplicate_msg,icon:'fa fa-info-circle',type:'blue',buttons:{confirm:{text:wpforms_builder.close,btnClass:'btn-confirm',keys:['enter'],},},});}else{$.confirm({title:false,content:wpforms_builder.duplicate_confirm,icon:'fa fa-exclamation-circle',type:'orange',buttons:{confirm:{text:wpforms_builder.ok,btnClass:'btn-confirm',keys:['enter'],action:function(){var $fieldOptions=$('#wpforms-field-option-'+id),isModernDropdown=app.dropdownField.helpers.isModernSelect($field.find('.primary-input'));wpf.restoreTooltips($fieldOptions);if(isModernDropdown){app.dropdownField.helpers.convertModernToClassic(id);}
var $newField=$field.clone(),newFieldOptions=$fieldOptions.html(),newFieldID=$('#wpforms-field-id').val(),$labelField=$('#wpforms-field-option-'+id+'-label').length?$('#wpforms-field-option-'+id+'-label'):$('#wpforms-field-option-'+id+'-name'),newFieldLabel=$labelField.length?$labelField.val()+' '+wpforms_builder.duplicate_copy:wpforms_builder.field+' #'+id+' '+wpforms_builder.duplicate_copy,nextID=Number(newFieldID)+1,regex_fieldOptionsID=new RegExp('ID #'+id,"g"),regex_fieldID=new RegExp('fields\\['+id+'\\]',"g"),regex_dataFieldID=new RegExp('data-field-id="'+id+'"',"g"),regex_referenceID=new RegExp('data-reference="'+id+'"',"g"),regex_elementID=new RegExp('\\b(id|for)="wpforms-(.*?)'+id+'(.*?)"',"ig");$field.after($newField);$field.removeClass('active');$newField.addClass('active').attr({'id':'wpforms-field-'+newFieldID,'data-field-id':newFieldID});function regex_elementID_replace(match,p1,p2,p3,offset,string){return p1+'="wpforms-'+p2+newFieldID+p3+'"';}
newFieldOptions=newFieldOptions.replace(regex_fieldOptionsID,'ID #'+newFieldID);newFieldOptions=newFieldOptions.replace(regex_fieldID,'fields['+newFieldID+']');newFieldOptions=newFieldOptions.replace(regex_dataFieldID,'data-field-id="'+newFieldID+'"');newFieldOptions=newFieldOptions.replace(regex_referenceID,'data-reference="'+newFieldID+'"');newFieldOptions=newFieldOptions.replace(regex_elementID,regex_elementID_replace);$fieldOptions.hide().after('<div class="'+$fieldOptions.attr('class')+'" id="wpforms-field-option-'+newFieldID+'" data-field-id="'+newFieldID+'">'+newFieldOptions+'</div>');var $newFieldOptions=$('#wpforms-field-option-'+newFieldID);$fieldOptions.find(':input').each(function(index,el){var $this=$(this),name=$this.attr('name');if(!name){return 'continue';}
var newName=name.replace(regex_fieldID,'fields['+newFieldID+']'),type=$this.attr('type');if(type==='checkbox'||type==='radio'){if($this.is(':checked')){$newFieldOptions.find('[name="'+newName+'"]').prop('checked',true).attr('checked','checked');}else{$newFieldOptions.find('[name="'+newName+'"]').prop('checked',false).attr('checked',false);}}else if($this.is('select')){if($this.find('option:selected').length){var optionVal=$this.find('option:selected').val();$newFieldOptions.find('[name="'+newName+'"]').find('[value="'+optionVal+'"]').prop('selected',true);}}else{if($this.val()!==''){$newFieldOptions.find('[name="'+newName+'"]').val($this.val());}else if($this.hasClass('wpforms-money-input')){$newFieldOptions.find('[name="'+newName+'"]').val(wpf.numberFormat('0',wpforms_builder.currency_decimals,wpforms_builder.currency_decimal,wpforms_builder.currency_thousands));}}});$('#wpforms-field-option-'+newFieldID).find('.wpforms-field-option-hidden-id').val(newFieldID);$('#wpforms-field-id').val(nextID);$('#wpforms-field-option-'+newFieldID+'-label').val(newFieldLabel);if(type==='html'){$('#wpforms-field-option-'+newFieldID+'-name').val(newFieldLabel);}
$newField.find('.label-title .text').text(newFieldLabel);$builder.trigger('wpformsFieldAdd',[newFieldID,type]);wpf.initTooltips();if(isModernDropdown){app.dropdownField.helpers.convertClassicToModern(id);app.dropdownField.helpers.convertClassicToModern(newFieldID);}
app.fieldChoiceUpdate($newField.data('field-type'),newFieldID);$.post(wpforms_builder.ajax_url,{form_id:s.formID,nonce:wpforms_builder.nonce,action:'wpforms_builder_increase_next_field_id',});},},cancel:{text:wpforms_builder.cancel,},},});}},addEntryPreviewAndPageBreakFields:function(options,position){app.fieldAdd('entry-preview',options).done(function(res){var entryPreviewId=res.data.field.id;app.fieldAdd('pagebreak',{'position':position+1}).done(function(){app.lockEntryPreviewFieldsPosition(entryPreviewId);});});},lockEntryPreviewFieldsPosition:function(id){var $entryPreviewField=$('#wpforms-field-'+id),$pageBreakField=$entryPreviewField.prevAll('.wpforms-field-pagebreak:not(.wpforms-pagebreak-bottom)').first(),$nextPageBreakField=$entryPreviewField.nextAll('.wpforms-field-pagebreak').first(),pageBreakFieldId=$nextPageBreakField.data('field-id'),$pageBreakOptions=$('#wpforms-field-option-'+pageBreakFieldId),$pageBreakPrevToggle=$pageBreakOptions.find('.wpforms-field-option-row-prev_toggle'),$pageBreakPrevToggleField=$pageBreakPrevToggle.find('input');$entryPreviewField.addClass('wpforms-field-not-draggable');$pageBreakField.addClass('wpforms-field-not-draggable wpforms-field-entry-preview-not-deleted');$pageBreakPrevToggleField.attr('checked','checked').trigger('change');$pageBreakPrevToggle.addClass('wpforms-entry-preview-block');$('#wpforms-add-fields-entry-preview').removeClass('wpforms-entry-preview-adding');},isEntryPreviewFieldRequiresPageBreakBefore:function($fields,position){var $beforeFields=$fields.slice(0,position).filter('.wpforms-field-pagebreak,.wpforms-field-entry-preview'),needPageBreakBefore=true;if(!$beforeFields.length){return needPageBreakBefore;}
$($beforeFields.get().reverse()).each(function(){var $this=$(this);if($this.hasClass('wpforms-field-entry-preview')){return false;}
if($this.hasClass('wpforms-field-pagebreak')&&!$this.hasClass('wpforms-field-stick')){needPageBreakBefore=false;return false;}});return needPageBreakBefore;},isEntryPreviewFieldRequiresPageBreakAfter:function($fields,position){var $afterFields=$fields.slice(position).filter('.wpforms-field-pagebreak,.wpforms-field-entry-preview'),needPageBreakAfter=Boolean($afterFields.length);if(!$afterFields.length){return needPageBreakAfter;}
$afterFields.each(function(){var $this=$(this);if($this.hasClass('wpforms-field-entry-preview')){return false;}
if($this.hasClass('wpforms-field-pagebreak')){needPageBreakAfter=false;return false;}});return needPageBreakAfter;},fieldAdd:function(type,options){var $btn=$('#wpforms-add-fields-'+type);if($btn.hasClass('upgrade-modal')||$btn.hasClass('education-modal')||$btn.hasClass('warning-modal')){return;}
if(-1!==$.inArray(type,['captcha_hcaptcha','captcha_recaptcha','captcha_none'])){app.captchaUpdate();return;}
adding=true;app.disableDragAndDrop();if(app.isUncheckedEntryPreviewField(type,options)){app.addEntryPreviewField(type,options);return;}
var defaults={position:'bottom',placeholder:false,scroll:true,defaults:false};options=$.extend({},defaults,options);var data={action:'wpforms_new_field_'+type,id:s.formID,type:type,defaults:options.defaults,nonce:wpforms_builder.nonce};return $.post(wpforms_builder.ajax_url,data,function(res){if(res.success){var $fields=$('#wpforms-panel-fields .wpforms-field'),$lastField=$fields.last(),totalFields=$fields.length,$preview=$('#wpforms-panel-fields .wpforms-panel-content-wrap'),$newField=$(res.data.preview),$newOptions=$(res.data.options);adding=false;$newField.css('display','none');if(options.placeholder){options.placeholder.remove();}
if(options.position==='bottom'){if($lastField.length&&$lastField.hasClass('wpforms-field-stick')){$('#wpforms-panel-fields .wpforms-field-wrap').children(':eq('+(totalFields-1)+')').before($newField);$('#wpforms-panel-fields .wpforms-field-options').children(':eq('+(totalFields-1)+')').before($newOptions);}else{$('#wpforms-panel-fields .wpforms-field-wrap').append($newField);$('#wpforms-panel-fields .wpforms-field-options').append($newOptions);}}else if(options.position==='top'){$('#wpforms-panel-fields .wpforms-field-wrap').prepend($newField);$('#wpforms-panel-fields .wpforms-field-options').prepend($newOptions);}else{if(options.position===totalFields&&$lastField.length&&$lastField.hasClass('wpforms-field-stick')){$('#wpforms-panel-fields .wpforms-field-wrap').children(':eq('+(totalFields-1)+')').before($newField);$('#wpforms-panel-fields .wpforms-field-options').children(':eq('+(totalFields-1)+')').before($newOptions);}else if($('#wpforms-panel-fields .wpforms-field-wrap').find('.wpforms-field').eq(options.position).length){$('#wpforms-panel-fields .wpforms-field-wrap').find('.wpforms-field').eq(options.position).before($newField);$('#wpforms-panel-fields .wpforms-field-options').find('.wpforms-field-option').eq(options.position).before($newOptions);}else{$('#wpforms-panel-fields .wpforms-field-wrap').append($newField);$('#wpforms-panel-fields .wpforms-field-options').append($newOptions);}}
$newField.fadeIn();$builder.find('.no-fields, .no-fields-preview').remove();$builder.find('.wpforms-field-submit').show();if(options.scroll&&options.position.length){var scrollTop=$preview.scrollTop(),newFieldPosition=$newField.position().top,scrollAmount=newFieldPosition>scrollTop?newFieldPosition-scrollTop:newFieldPosition+scrollTop;$preview.animate({scrollTop:options.position==='bottom'?scrollAmount:0,},1000);}
$('#wpforms-field-id').val(res.data.field.id+1);wpf.initTooltips();app.loadColorPickers();app.toggleAllOptionGroups();$builder.trigger('wpformsFieldAdd',[res.data.field.id,type]);}else{console.log(res);}}).fail(function(xhr,textStatus,e){adding=false;console.log(xhr.responseText);}).always(function(){$builder.find('.wpforms-add-fields .wpforms-add-fields-button').prop('disabled',false);if(!adding){app.enableDragAndDrop();}});},captchaUpdate:function(){var data={action:'wpforms_update_field_captcha',id:s.formID,nonce:wpforms_builder.nonce,};return $.post(wpforms_builder.ajax_url,data,function(res){if(res.success){var args={title:false,content:false,icon:'fa fa-exclamation-circle',type:'orange',boxWidth:'450px',buttons:{confirm:{text:wpforms_builder.ok,btnClass:'btn-confirm',keys:['enter'],},},},$enableCheckbox=$('#wpforms-panel-field-settings-recaptcha'),caseName=res.data.current;$enableCheckbox.data('provider',res.data.provider);if('configured_not_enabled'===caseName||'configured_enabled'===caseName){caseName=$enableCheckbox.prop('checked')?'configured_enabled':'configured_not_enabled';args.buttons.confirm.action=function(){$enableCheckbox.prop('checked',('configured_not_enabled'===caseName)).trigger('change');};}
args.title=res.data.cases[caseName].title;args.content=res.data.cases[caseName].content;if(res.data.cases[caseName].cancel){args.buttons.cancel={text:wpforms_builder.cancel,keys:['esc'],};}
$.confirm(args);}else{console.log(res);}}).fail(function(xhr,textStatus,e){console.log(xhr.responseText);});},disableDragAndDrop:function(){elements.$addFieldsButtons.filter('.ui-draggable').draggable('disable');elements.$sortableFieldsWrap.filter('.ui-sortable').sortable('disable');},enableDragAndDrop:function(){elements.$addFieldsButtons.filter('.ui-draggable').draggable('enable');elements.$sortableFieldsWrap.filter('.ui-sortable').sortable('enable');},fieldSortable:function(){var fieldOptions=$('.wpforms-field-options'),fieldReceived=false,fieldIndex,fieldIndexNew,field,fieldNew,$scrollContainer=$('#wpforms-panel-fields .wpforms-panel-content-wrap'),currentlyScrolling=false;elements.$sortableFieldsWrap.sortable({items:'> .wpforms-field:not(.wpforms-field-stick):not(.no-fields-preview)',axis:'y',delay:100,opacity:0.75,cursor:'move',start:function(e,ui){fieldIndex=ui.item.index();field=fieldOptions[0].children[fieldIndex];},stop:function(e,ui){fieldIndexNew=ui.item.index();fieldNew=fieldOptions[0].children[fieldIndexNew];if(fieldIndex<fieldIndexNew){$(fieldNew).after(field);}else{$(fieldNew).before(field);}
$builder.trigger('wpformsFieldMove',ui);fieldReceived=false;},over:function(e,ui){var $el=ui.item.first();$el.addClass('wpforms-field-dragging');if($el.hasClass('wpforms-field-drag')){var width=$('.wpforms-field').outerWidth()||elements.$sortableFieldsWrap.find('.no-fields-preview').outerWidth();$el.addClass('wpforms-field-drag-over').removeClass('wpforms-field-drag-out').css('width',width).css('height','auto');}},out:function(e,ui){var $el=ui.item.first();$el.removeClass('wpforms-field-dragging');if(!fieldReceived){var width=$el.attr('data-original-width');if($el.hasClass('wpforms-field-drag')){$el.addClass('wpforms-field-drag-out').removeClass('wpforms-field-drag-over').css({'width':width,'left':'','top':''});}}
$el.css({'top':'','left':'','z-index':'',});},receive:function(e,ui){fieldReceived=true;var pos=$(this).data('ui-sortable').currentItem.index(),$el=ui.helper,type=$el.attr('data-field-type');$el.addClass('wpforms-field-drag-over wpforms-field-drag-pending').removeClass('wpforms-field-drag-out').css('width','100%');$el.append(s.spinnerInline);$builder.find('.wpforms-add-fields .wpforms-add-fields-button').prop('disabled',true);$builder.find('.no-fields-preview').remove();app.fieldAdd(type,{position:pos,placeholder:$el});},sort:function(e,ui){if(currentlyScrolling){return;}
var scrollAreaHeight=50,operator,mouseYPosition=e.clientY,containerOffset=$scrollContainer.offset(),containerHeight=$scrollContainer.height(),containerBottom=containerOffset.top+containerHeight;if(mouseYPosition>containerOffset.top&&mouseYPosition<(containerOffset.top+scrollAreaHeight)){operator='-=';}else if(mouseYPosition>(containerBottom-scrollAreaHeight)&&mouseYPosition<containerBottom){operator='+=';}else{return;}
currentlyScrolling=true;$scrollContainer.animate({scrollTop:operator+containerHeight/3+'px',},800,function(){currentlyScrolling=false;});},cancel:'.wpforms-field-not-draggable',});var startTopPosition;$('.wpforms-field-not-draggable, .wpforms-field-stick').draggable({revert:true,axis:'y',delay:100,opacity:0.75,cursor:'move',start:function(event,ui){startTopPosition=ui.position.top;},drag:function(event,ui){if(Math.abs(ui.position.top)-Math.abs(startTopPosition)>15){app.youCantReorderFieldPopup();return false;}},});$('.wpforms-add-fields-button').not('.not-draggable').not('.warning-modal').not('.education-modal').draggable({connectToSortable:'.wpforms-field-wrap',delay:200,helper:function(){var $this=$(this),width=$this.outerWidth(),text=$this.html(),type=$this.data('field-type'),$el=$('<div class="wpforms-field-drag-out wpforms-field-drag">');return $el.html(text).css('width',width).attr({'data-original-width':width,'data-field-type':type});},revert:'invalid',cancel:false,scroll:false,opacity:0.75,containment:'document',});elements.$addFieldsButtons.draggable({connectToSortable:'.wpforms-field-wrap',delay:200,helper:function(){var $this=$(this),width=$this.outerWidth(),text=$this.html(),type=$this.data('field-type'),$el=$('<div class="wpforms-field-drag-out wpforms-field-drag">');return $el.html(text).css('width',width).attr({'data-original-width':width,'data-field-type':type});},revert:'invalid',cancel:false,scroll:false,opacity:0.75,containment:'document',});},fieldChoiceAdd:function(event,el){event.preventDefault();var $this=$(el),$parent=$this.parent(),checked=$parent.find('input.default').is(':checked'),fieldID=$this.closest('.wpforms-field-option-row-choices').data('field-id'),id=$parent.parent().attr('data-next-id'),type=$parent.parent().data('field-type'),$choice=$parent.clone().insertAfter($parent);$choice.attr('data-key',id);$choice.find('input.label').val('').attr('name','fields['+fieldID+'][choices]['+id+'][label]');$choice.find('input.value').val('').attr('name','fields['+fieldID+'][choices]['+id+'][value]');$choice.find('input.source').val('').attr('name','fields['+fieldID+'][choices]['+id+'][image]');$choice.find('input.default').attr('name','fields['+fieldID+'][choices]['+id+'][default]').prop('checked',false);$choice.find('.preview').empty();$choice.find('.wpforms-image-upload-add').show();$choice.find('.wpforms-money-input').trigger('focusout');if(checked===true){$parent.find('input.default').prop('checked',true);}
id++;$parent.parent().attr('data-next-id',id);$builder.trigger('wpformsFieldChoiceAdd');app.fieldChoiceUpdate(type,fieldID);},fieldChoiceDelete:function(e,el){e.preventDefault();var $this=$(el),$list=$this.parent().parent(),total=$list.find('li').length,fieldData={'id':$list.data('field-id'),'choiceId':$this.closest('li').data('key'),'message':'<strong>'+wpforms_builder.delete_choice_confirm+'</strong>','trigger':false,};$builder.trigger('wpformsBeforeFieldDeleteAlert',[fieldData]);if(total===1){app.fieldChoiceDeleteAlert();}else{var deleteChoice=function(){$this.parent().remove();app.fieldChoiceUpdate($list.data('field-type'),$list.data('field-id'));$builder.trigger('wpformsFieldChoiceDelete');};if(!fieldData.trigger){deleteChoice();return;}
$.confirm({title:false,content:fieldData.message,icon:'fa fa-exclamation-circle',type:'orange',buttons:{confirm:{text:wpforms_builder.ok,btnClass:'btn-confirm',keys:['enter'],action:function(){deleteChoice();},},cancel:{text:wpforms_builder.cancel,},},});}},fieldChoiceDeleteAlert:function(){$.alert({title:false,content:wpforms_builder.error_choice,icon:'fa fa-info-circle',type:'blue',buttons:{confirm:{text:wpforms_builder.ok,btnClass:'btn-confirm',keys:['enter'],},},});},fieldChoiceSortable:function(type,selector){selector=typeof selector!=='undefined'?selector:'.wpforms-field-option-'+type+' .wpforms-field-option-row-choices ul';$(selector).sortable({items:'li',axis:'y',delay:100,opacity:0.6,handle:'.move',stop:function(e,ui){var id=ui.item.parent().data('field-id');app.fieldChoiceUpdate(type,id);$builder.trigger('wpformsFieldChoiceMove',ui);},update:function(e,ui){}});},fieldChoiceLabel:function(data,choiceID){var label=typeof data.settings.choices[choiceID].label!=='undefined'&&data.settings.choices[choiceID].label.length!==0?wpf.sanitizeHTML(data.settings.choices[choiceID].label):wpforms_builder.choice_empty_label_tpl.replace('{number}',choiceID);if(data.settings.show_price_after_labels){label+=' - '+wpf.amountFormatCurrency(data.settings.choices[choiceID].value);}
return label;},fieldChoiceUpdate:function(type,id){var $primary=$('#wpforms-field-'+id+' .primary-input');if('radio'===type||'checkbox'===type||'payment-multiple'===type||'payment-checkbox'===type){var fieldSettings=wpf.getField(id),order=wpf.getChoicesOrder(id),slicedChoices={},slicedOrder=order.slice(0,20),tmpl=wp.template('wpforms-field-preview-checkbox-radio-payment-multiple'),data={settings:fieldSettings,order:slicedOrder,type:'radio',};slicedOrder.forEach(function(entry){slicedChoices[entry]=fieldSettings.choices[entry];});fieldSettings.choices=slicedChoices;if('checkbox'===type||'payment-checkbox'===type){data.type='checkbox';}
$('#wpforms-field-'+id).find('ul.primary-input').replaceWith(tmpl(data));app.firstNChoicesAlert(id,order.length);return;}
var isModernSelect=app.dropdownField.helpers.isModernSelect($primary),newChoice='';if('payment-multiple'===type){type='radio';}
if('payment-checkbox'===type){type='checkbox';}
if('payment-select'===type){type='select';}
if('select'===type){newChoice='<option value="{label}">{label}</option>';$primary.find('option').not('.placeholder').remove();}else if('radio'===type||'checkbox'===type||'gdpr-checkbox'===type){type='gdpr-checkbox'===type?'checkbox':type;$primary.find('li').remove();newChoice='<li><input type="'+type+'" disabled>{label}</li>';}
var $choicesList=$('#wpforms-field-option-row-'+id+'-choices .choices-list'),$choicesToRender=$choicesList.find('li').slice(0,20),hasDefaults=!!$choicesList.find('input.default:checked').length,modernSelectChoices=[],showPriceAfterLabels=$('#wpforms-field-option-'+id+'-show_price_after_labels').prop('checked');$choicesToRender.each(function(){var $this=$(this),label=wpf.sanitizeHTML($this.find('input.label').val().trim()),value=$this.find('input.value').val(),selected=$this.find('input.default').is(':checked'),choiceID=$this.data('key'),$choice;label=label!==''?label:wpforms_builder.choice_empty_label_tpl.replace('{number}',choiceID);label+=(showPriceAfterLabels&&value)?' - '+wpf.amountFormatCurrency(value):'';if(!isModernSelect){$choice=$(newChoice.replace(/{label}/g,label));$primary.append($choice);}else{modernSelectChoices.push({value:label,label:label,});}
if(true===selected){switch(type){case 'select':if(!isModernSelect){$choice.prop('selected','true');}else{modernSelectChoices[modernSelectChoices.length-1].selected=true;}
break;case 'radio':case 'checkbox':$choice.find('input').prop('checked','true');break;}}});if(isModernSelect){var placeholderClass=$primary.prop('multiple')?'input.choices__input':'.choices__inner .choices__placeholder',choicesjsInstance=app.dropdownField.helpers.getInstance($primary),isDynamicChoices=$('#wpforms-field-option-'+id+'-dynamic_choices').val();choicesjsInstance.removeActiveItems();choicesjsInstance.setChoices(modernSelectChoices,'value','label',true);app.dropdownField.helpers.update(id,isDynamicChoices);$primary.closest('.choices').find(placeholderClass).toggleClass('wpforms-hidden',hasDefaults);}},fieldChoiceBulkAddToggle:function(el){var $this=$(el),$label=$this.closest('label');if($this.hasClass('bulk-add-showing')){var $selector=$label.next('.bulk-add-display');$selector.slideUp(400,function(){$selector.remove();});$this.find('span').text(wpforms_builder.bulk_add_show);}else{var importOptions='<div class="bulk-add-display unfoldable-cont">';importOptions+='<p class="heading wpforms-clear">'+wpforms_builder.bulk_add_heading+' <a href="#" class="toggle-bulk-add-presets">'+wpforms_builder.bulk_add_presets_show+'</a></p>';importOptions+='<ul>';for(var key in wpforms_preset_choices){importOptions+='<li><a href="#" data-preset="'+key+'" class="bulk-add-preset-insert">'+wpforms_preset_choices[key].name+'</a></li>';}
importOptions+='</ul>';importOptions+='<textarea placeholder="'+wpforms_builder.bulk_add_placeholder+'"></textarea>';importOptions+='<button class="bulk-add-insert wpforms-btn wpforms-btn-sm wpforms-btn-blue">'+wpforms_builder.bulk_add_button+'</button>';importOptions+='</div>';$label.after(importOptions);$label.next('.bulk-add-display').slideDown(400,function(){$(this).find('textarea').focus();});$this.find('span').text(wpforms_builder.bulk_add_hide);}
$this.toggleClass('bulk-add-showing');},fieldChoiceBulkAddInsert:function(el){var $this=$(el),$container=$this.closest('.wpforms-field-option-row'),$textarea=$container.find('textarea'),$list=$container.find('.choices-list'),$choice=$list.find('li:first-of-type').clone().wrap('<div>').parent(),choice='',fieldID=$container.data('field-id'),type=$list.data('field-type'),nextID=Number($list.attr('data-next-id')),newValues=$textarea.val().split('\n'),newChoices='';$this.prop('disabled',true).html($this.html()+' '+s.spinner);$choice.find('input.value,input.label').attr('value','');choice=$choice.html();for(var key in newValues){if(!newValues.hasOwnProperty(key)){continue;}
var value=wpf.sanitizeHTML(newValues[key]).trim().replace(/"/g,'&quot;'),newChoice=choice;newChoice=newChoice.replace(/\[choices\]\[(\d+)\]/g,'[choices]['+nextID+']');newChoice=newChoice.replace(/data-key="(\d+)"/g,'data-key="'+nextID+'"');newChoice=newChoice.replace(/value="" class="label"/g,'value="'+value+'" class="label"');newChoice=newChoice.replace(/class="label" type="text" value=""/g,'class="label" type="text" value="'+value+'"');newChoices+=newChoice;nextID++;}
$list.attr('data-next-id',nextID).append(newChoices);app.fieldChoiceUpdate(type,fieldID);$builder.trigger('wpformsFieldChoiceAdd');app.fieldChoiceBulkAddToggle($container.find('.toggle-bulk-add-display'));},fieldTabToggle:function(id){$('.wpforms-tab a').removeClass('active');$('.wpforms-field, .wpforms-title-desc').removeClass('active');if(id==='add-fields'){$('#add-fields a').addClass('active');$('.wpforms-field-options').hide();$('.wpforms-add-fields').show();}else{$('#field-options a').addClass('active');if(id==='field-options'){var $field=$('.wpforms-field').first();$field.addClass('active');id=$field.data('field-id');}else{$('#wpforms-field-'+id).addClass('active');}
$('.wpforms-field-option').hide();$('#wpforms-field-option-'+id).show();$('.wpforms-add-fields').hide();$('.wpforms-field-options').show();}},fieldPagebreakAdd:function(event,id,type){if('pagebreak'!==type){return;}
var options;if(!s.pagebreakTop){s.pagebreakTop=true;options={position:'top',scroll:false,defaults:{position:'top',nav_align:'left',},};app.fieldAdd('pagebreak',options).done(function(res){s.pagebreakTop=res.data.field.id;var $preview=$('#wpforms-field-'+res.data.field.id),$options=$('#wpforms-field-option-'+res.data.field.id);$options.find('.wpforms-field-option-group').addClass('wpforms-pagebreak-top');$preview.addClass('wpforms-field-stick wpforms-pagebreak-top');});}else if(!s.pagebreakBottom){s.pagebreakBottom=true;options={position:'bottom',scroll:false,defaults:{position:'bottom',},};app.fieldAdd('pagebreak',options).done(function(res){s.pagebreakBottom=res.data.field.id;var $preview=$('#wpforms-field-'+res.data.field.id),$options=$('#wpforms-field-option-'+res.data.field.id);$options.find('.wpforms-field-option-group').addClass('wpforms-pagebreak-bottom');$preview.addClass('wpforms-field-stick wpforms-pagebreak-bottom');});}},fieldPagebreakDelete:function(event,id,type){if('pagebreak'!==type){return;}
var pagebreaksRemaining=$('#wpforms-panel-fields .wpforms-field-pagebreak').not('.wpforms-pagebreak-top, .wpforms-pagebreak-bottom').length;if(pagebreaksRemaining){return;}
var $preview=$('#wpforms-panel-fields .wpforms-preview-wrap'),$top=$preview.find('.wpforms-pagebreak-top'),topID=$top.data('field-id'),$bottom=$preview.find('.wpforms-pagebreak-bottom'),bottomID=$bottom.data('field-id');$top.remove();$('#wpforms-field-option-'+topID).remove();s.pagebreakTop=false;$bottom.remove();$('#wpforms-field-option-'+bottomID).remove();s.pagebreakBottom=false;},fieldPageBreakInitDisplayPrevious:function($field){var id=$field.data('field-id'),$prevToggle=$('#wpforms-field-option-row-'+id+'-prev_toggle'),$prev=$('#wpforms-field-option-row-'+id+'-prev'),$prevBtn=$field.find('.wpforms-pagebreak-prev');if($field.prevAll('.wpforms-field-pagebreak.wpforms-pagebreak-normal').length>0){$prevToggle.removeClass('hidden');$prev.removeClass('hidden');if($prevToggle.find('input').is(':checked')){$prevBtn.removeClass('wpforms-hidden').text($prev.find('input').val());}}else{$prevToggle.addClass('hidden');$prev.addClass('hidden');$prevBtn.addClass('wpforms-hidden');}},fieldDynamicChoiceToggle:function(el){var $this=$(el),$thisOption=$this.parent(),value=$this.val(),id=$thisOption.data('field-id'),type=$('#wpforms-field-option-'+id).find('.wpforms-field-option-hidden-type').val(),$field=$('#wpforms-field-'+id),$choices=$('#wpforms-field-option-row-'+id+'-choices'),$images=$('#wpforms-field-option-'+id+'-choices_images');app.fieldDynamicChoiceToggleImageChoices();$builder.trigger('wpformsFieldDynamicChoiceToggle');wpf.fieldOptionLoading($thisOption);$('#wpforms-field-option-row-'+id+'-dynamic_post_type').remove();$('#wpforms-field-option-row-'+id+'-dynamic_taxonomy').remove();if(''!==value){$images.addClass('wpforms-hidden');$choices.find('.toggle-bulk-add-display').addClass('wpforms-hidden');var data={type:value,field_id:id,action:'wpforms_builder_dynamic_choices',nonce:wpforms_builder.nonce,};$.post(wpforms_builder.ajax_url,data,function(res){if(res.success){$thisOption.after(res.data.markup);}else{console.log(res);}
wpf.fieldOptionLoading($thisOption,true);wpf.initTooltips();$('#wpforms-field-option-'+id+'-dynamic_'+value).find('option:first').prop('selected',true);$('#wpforms-field-option-'+id+'-dynamic_'+value).trigger('change');}).fail(function(xhr,textStatus,e){console.log(xhr.responseText);});return;}
$images.removeClass('wpforms-hidden');$choices.find('.toggle-bulk-add-display').removeClass('wpforms-hidden');$('#wpforms-field-'+id).find('.wpforms-alert').remove();if(['checkbox','radio','payment-multiple','payment-checkbox'].indexOf(type)>-1){app.fieldChoiceUpdate(type,id);$choices.find('ul').removeClass('wpforms-hidden');$choices.find('.wpforms-alert').addClass('wpforms-hidden');wpf.fieldOptionLoading($thisOption,true);return;}
var choices=[],$primary=$field.find('.primary-input'),key;$('#wpforms-field-option-row-'+id+'-choices li').each(function(){var $this=$(this);choices.push({label:wpf.sanitizeHTML($this.find('.label').val()),selected:$this.find('.default').is(':checked'),});});if($field.hasClass('wpforms-field-select')){var isModernSelect=app.dropdownField.helpers.isModernSelect($primary),optionHTML='',selected=false;$primary.find('option').not('.placeholder').remove();if(isModernSelect&&choices.length){app.dropdownField.helpers.update(id,false);}else{for(key in choices){selected=choices[key].selected;optionHTML='<option';optionHTML+=selected?' selected>':'>';optionHTML+=choices[key].label+'</option>';$primary.append(optionHTML);}}}else{type='radio';if($field.hasClass('wpforms-field-checkbox')){type='checkbox';}
$primary.empty();for(key in choices){optionHTML='<li><input type="'+type+'" disabled';optionHTML+=choices[key].selected?' selected>':'>';optionHTML+=choices[key].label+'</li>';$primary.append(optionHTML);}}
$choices.find('ul').removeClass('wpforms-hidden');$choices.find('.wpforms-alert').addClass('wpforms-hidden');wpf.fieldOptionLoading($thisOption,true);},fieldDynamicChoiceSource:function(el){var $this=$(el),$thisOption=$this.parent(),value=$this.val(),id=$thisOption.data('field-id'),form_id=$('#wpforms-builder-form').data('id'),$choices=$('#wpforms-field-option-row-'+id+'-choices'),$field=$('#wpforms-field-'+id),type=$('#wpforms-field-option-'+id+'-dynamic_choices option:selected').val(),limit=20;wpf.fieldOptionLoading($thisOption);var data={type:type,source:value,field_id:id,form_id:form_id,action:'wpforms_builder_dynamic_source',nonce:wpforms_builder.nonce};$.post(wpforms_builder.ajax_url,data,function(res){if(!res.success){console.log(res);wpf.fieldOptionLoading($thisOption,true);return;}
$choices.find('.dynamic-name').text(res.data.source_name);$choices.find('.dynamic-type').text(res.data.type_name);$choices.find('ul').addClass('wpforms-hidden');$choices.find('.wpforms-alert').removeClass('wpforms-hidden');app.fieldDynamicChoiceSourceItems($field,res.data.items);if($field.hasClass('wpforms-field-select')){limit=200;}
if(Number(res.data.total)>limit){var msg=wpforms_builder.dynamic_choice_limit;msg=msg.replace('{source}',res.data.source_name);msg=msg.replace('{type}',res.data.type_name);msg=msg.replace('{limit}',limit);msg=msg.replace('{total}',res.data.total);$.alert({title:wpforms_builder.heads_up,content:msg,icon:'fa fa-info-circle',type:'blue',buttons:{confirm:{text:wpforms_builder.ok,btnClass:'btn-confirm',keys:['enter'],},},});}
app.firstNChoicesAlert(id,res.data.total);wpf.fieldOptionLoading($thisOption,true);}).fail(function(xhr,textStatus,e){console.log(xhr.responseText);});},fieldDynamicChoiceSourceItems:function($field,items){var $primary=$field.find('.primary-input'),key=0;if($field.hasClass('wpforms-field-select')){var isModernSelect=app.dropdownField.helpers.isModernSelect($primary);if(isModernSelect){app.fieldDynamicChoiceSourceForModernSelect($primary,items);}else{app.fieldDynamicChoiceSourceForClassicSelect($primary,items);}}else{var type='radio';if($field.hasClass('wpforms-field-checkbox')){type='checkbox';}
$primary.empty();for(key in items){$primary.append('<li><input type="'+type+'" disabled> '+wpf.sanitizeHTML(items[key])+'</li>');}}},fieldDynamicChoiceSourceForModernSelect:function($jquerySelector,items){var instance=app.dropdownField.helpers.getInstance($jquerySelector),fieldId=$jquerySelector.closest('.wpforms-field').data().fieldId;instance.destroy();app.dropdownField.helpers.updatePlaceholderChoice(instance,fieldId);app.fieldDynamicChoiceSourceForClassicSelect($jquerySelector,items);app.dropdownField.events.choicesInit($jquerySelector);},fieldDynamicChoiceSourceForClassicSelect:function($jquerySelector,items){var index=0,itemsSize=items.length;$jquerySelector.find('option').not('.placeholder').remove();for(;index<itemsSize;index++){var item=wpf.sanitizeHTML(items[index]);$jquerySelector.append('<option value="'+item+'">'+item+'</option>');}},fieldDynamicChoiceToggleImageChoices:function(){$('#wpforms-builder .wpforms-field-options .wpforms-field-option').each(function(key,value){var $option=$(value),dynamicChoices=$option.find('.wpforms-field-option-row-dynamic_choices select').val(),isDynamicChoices=typeof dynamicChoices!=='undefined'&&''!==dynamicChoices,isImageChoices=$option.find('.wpforms-field-option-row-choices_images input').is(':checked');$option.find('.wpforms-field-option-row-choices_images').toggleClass('wpforms-hidden',isDynamicChoices);if(!isImageChoices||isDynamicChoices){$option.find('.wpforms-field-option-row-choices_images_style').addClass('wpforms-hidden');}});},firstNChoicesAlert:function(fieldId,total){var tmpl=wp.template('wpforms-choices-limit-message'),data={total:total,},limit=20,$field=$('#wpforms-field-'+fieldId);if($field.hasClass('wpforms-field-select')){return;}
$field.find('.wpforms-alert-dynamic').remove();if(total>limit){$field.find('.primary-input').after(tmpl(data));}},fieldLayoutSelectorToggle:function(el){var $this=$(el),$label=$this.closest('label'),layouts={'layout-1':[{'class':'one-half','data':'wpforms-one-half wpforms-first'},{'class':'one-half','data':'wpforms-one-half'}],'layout-2':[{'class':'one-third','data':'wpforms-one-third wpforms-first'},{'class':'one-third','data':'wpforms-one-third'},{'class':'one-third','data':'wpforms-one-third'}],'layout-3':[{'class':'one-fourth','data':'wpforms-one-fourth wpforms-first'},{'class':'one-fourth','data':'wpforms-one-fourth'},{'class':'one-fourth','data':'wpforms-one-fourth'},{'class':'one-fourth','data':'wpforms-one-fourth'}],'layout-4':[{'class':'one-third','data':'wpforms-one-third wpforms-first'},{'class':'two-third','data':'wpforms-two-thirds'}],'layout-5':[{'class':'two-third','data':'wpforms-two-thirds wpforms-first'},{'class':'one-third','data':'wpforms-one-third'}],'layout-6':[{'class':'one-fourth','data':'wpforms-one-fourth wpforms-first'},{'class':'one-fourth','data':'wpforms-one-fourth'},{'class':'two-fourth','data':'wpforms-two-fourths'}],'layout-7':[{'class':'two-fourth','data':'wpforms-two-fourths wpforms-first'},{'class':'one-fourth','data':'wpforms-one-fourth'},{'class':'one-fourth','data':'wpforms-one-fourth'}],'layout-8':[{'class':'one-fourth','data':'wpforms-one-fourth wpforms-first'},{'class':'two-fourth','data':'wpforms-two-fourths'},{'class':'one-fourth','data':'wpforms-one-fourth'}]};if($this.hasClass('layout-selector-showing')){var $selector=$label.next('.layout-selector-display');$selector.slideUp(400,function(){$selector.remove();});$this.find('span').text(wpforms_builder.layout_selector_show);}else{var layoutOptions='<div class="layout-selector-display unfoldable-cont">';layoutOptions+='<p class="heading">'+wpforms_builder.layout_selector_layout+'</p>';layoutOptions+='<div class="layouts">';for(var key in layouts){var layout=layouts[key];layoutOptions+='<div class="layout-selector-display-layout">';for(var i in layout){layoutOptions+='<span class="'+layout[i].class+'" data-classes="'+layout[i].data+'"></span>';}
layoutOptions+='</div>';}
layoutOptions+='</div></div>';$label.after(layoutOptions);$label.next('.layout-selector-display').slideDown();$this.find('span').text(wpforms_builder.layout_selector_hide);}
$this.toggleClass('layout-selector-showing');},fieldLayoutSelectorLayout:function(el){var $this=$(el),$label=$this.closest('label');$this.parent().find('.layout-selector-display-layout').not($this).remove();$this.parent().find('.heading').text(wpforms_builder.layout_selector_column);$this.toggleClass('layout-selector-display-layout layout-selector-display-columns')},fieldLayoutSelectorInsert:function(el){var $this=$(el),$selector=$this.closest('.layout-selector-display'),$parent=$selector.parent(),$label=$parent.find('label'),$input=$parent.find('input[type=text]'),classes=$this.data('classes');if($input.val()){classes=' '+classes;}
$input.insertAtCaret(classes);$selector.slideUp(400,function(){$selector.remove();});$label.find('.toggle-layout-selector-display').removeClass('layout-selector-showing');$label.find('.toggle-layout-selector-display span').text(wpforms_builder.layout_selector_show);},bindUIActionsSettings:function(){$builder.on('click','#wpforms-panel-fields .wpforms-title-desc, #wpforms-panel-fields .wpforms-field-submit-button, .wpforms-center-form-name',function(e){e.preventDefault();app.panelSwitch('settings');if($(this).hasClass('wpforms-center-form-name')||$(this).hasClass('wpforms-title-desc')){setTimeout(function(){$('#wpforms-panel-field-settings-form_title').focus();},300);}});$builder.on('click','.wpforms-field-pagebreak-last button',function(e){e.preventDefault();app.panelSwitch('settings');$('#wpforms-panel-field-settings-pagebreak_prev').focus();});$builder.on('input','#wpforms-panel-field-settings-pagebreak_prev',function(){$('.wpforms-field-pagebreak-last button').text($(this).val());});$builder.on('input','#wpforms-panel-field-settings-form_title, #wpforms-setup-name',function(){var title=$.trim($(this).val());$('.wpforms-preview .wpforms-form-name').text(title);$('.wpforms-center-form-name.wpforms-form-name').text(title);app.trimFormTitle();});$builder.on('input','#wpforms-panel-field-settings-form_desc',function(){$('.wpforms-form-desc').text($(this).val());});$builder.on('input','#wpforms-panel-field-settings-submit_text',function(){$('.wpforms-field-submit input[type=submit]').val($(this).val());});$builder.on('change','#wpforms-panel-field-settings-recaptcha',function(){app.captchaToggle();});$builder.on('change','.wpforms-panel-field-confirmations-type',function(){app.confirmationFieldsToggle($(this));});$builder.on('change','.wpforms-panel-field-confirmations-message_entry_preview',app.confirmationEntryPreviewToggle);$builder.on('change','#wpforms-panel-field-settings-notification_enable',function(){app.notificationToggle();});$builder.on('click','.wpforms-builder-settings-block-add',function(e){e.preventDefault();if(!wpforms_builder.pro){return;}
app.settingsBlockAdd($(this));});$builder.on('click','.wpforms-builder-settings-block-edit',function(e){e.preventDefault();var $el=$(this);if($el.parents('.wpforms-builder-settings-block-header').find('.wpforms-builder-settings-block-name').hasClass('editing')){app.settingsBlockNameEditingHide($el);}else{app.settingsBlockNameEditingShow($el);}});$builder.on('blur','.wpforms-builder-settings-block-name-edit input',function(e){if(!$(e.relatedTarget).hasClass('wpforms-builder-settings-block-edit')){app.settingsBlockNameEditingHide($(this));}});$builder.on('keypress','.wpforms-builder-settings-block-name-edit input',function(e){if(e.keyCode===13){app.settingsBlockNameEditingHide($(this));e.preventDefault();}});$builder.on('click','.wpforms-builder-settings-block-clone',function(e){e.preventDefault();app.settingsBlockPanelClone($(this));});$builder.on('click','.wpforms-builder-settings-block-toggle',function(e){e.preventDefault();app.settingsBlockPanelToggle($(this));});$builder.on('click','.wpforms-builder-settings-block-delete',function(e){e.preventDefault();app.settingsBlockDelete($(this));});},captchaToggle:function(){var $preview=$builder.find('.wpforms-field-recaptcha'),$setting=$('#wpforms-panel-field-settings-recaptcha'),provider=$setting.data('provider');provider=provider||'recaptcha';if(!$preview.length){return;}
if($setting.is(':checked')){$preview.show().toggleClass('is-recaptcha','recaptcha'===provider);}else{$preview.hide();}},confirmationsSetup:function(){$('.wpforms-panel-field-confirmations-type').each(function(){app.confirmationFieldsToggle($(this));});$('.wpforms-panel-field-confirmations-message').each(function(){if(typeof tinymce!=='undefined'&&typeof wp.editor!=='undefined'){wp.editor.initialize($(this).attr('id'),s.tinymceDefaults);}});$builder.on('focusout','.wpforms-panel-field-confirmations-redirect',function(event){var $field=$(this),url=$field.val().trim();$field.val(url);if(wpf.isURL(url)||url===''){return;}
$.confirm({title:wpforms_builder.heads_up,content:wpforms_builder.redirect_url_field_error,icon:'fa fa-exclamation-circle',type:'orange',buttons:{confirm:{text:wpforms_builder.ok,btnClass:'btn-confirm',keys:['enter'],action:function(){$field.focus();},},},});});},confirmationFieldsToggle:function($el){if(!$el.length){return;}
var type=$el.val(),$block=$el.closest('.wpforms-builder-settings-block-content');$block.find('.wpforms-panel-field').not($el.parent()).not('.wpforms-conditionals-enable-toggle').hide();$block.find('.wpforms-panel-field-confirmations-'+type).closest('.wpforms-panel-field').show();if(type==='message'){$block.find('.wpforms-panel-field-confirmations-message_scroll').closest('.wpforms-panel-field').show();$block.find('.wpforms-panel-field-confirmations-message_entry_preview').trigger('change').closest('.wpforms-panel-field').show();}},confirmationEntryPreviewToggle:function(){var $this=$(this),$styleField=$this.closest('.wpforms-builder-settings-block-content').find('.wpforms-panel-field-confirmations-message_entry_preview_style').parent();$this.is(':checked')?$styleField.show():$styleField.hide();},notificationToggle:function(){var $notification=$('#wpforms-panel-field-settings-notification_enable'),$settingsBlock=$notification.closest('.wpforms-panel-content-section').find('.wpforms-builder-settings-block'),$enabled=$notification.is(':checked');$('.wpforms-notifications-add').toggleClass('wpforms-hidden',!$enabled);$enabled?$settingsBlock.show():$settingsBlock.hide();},notificationsByStatusAlerts:function(){$builder.on('change','.wpforms-panel-content-section-notifications .wpforms-notification-by-status-alert',function(e){var $input=$(this);if(!$input.prop('checked')){return;}
var $enabled=$('.wpforms-radio-group-'+$input.attr('data-radio-group')+':checked:not(#'+$input.attr('id')+')'),alertText='';if($enabled.length===0){alertText=wpforms_builder.notification_by_status_enable_alert;alertText=alertText.replace(/%s/g,$input.data('provider-title'));}else{alertText=wpforms_builder.notification_by_status_switch_alert;alertText=alertText.replace(/%2\$s/g,$enabled.data('provider-title'));alertText=alertText.replace(/%1\$s/g,$input.data('provider-title'));}
$.confirm({title:wpforms_builder.heads_up,content:alertText,icon:'fa fa-exclamation-circle',type:'orange',buttons:{confirm:{text:wpforms_builder.ok,btnClass:'btn-confirm',},},});});},settingsBlockAdd:function($el){var nextID=Number($el.attr('data-next-id')),panelID=$el.closest('.wpforms-panel-content-section').data('panel'),blockType=$el.data('block-type'),namePrompt=wpforms_builder[blockType+'_prompt'],nameField='<input autofocus="" type="text" id="settings-block-name" placeholder="'+wpforms_builder[blockType+'_ph']+'">',nameError='<p class="error">'+wpforms_builder[blockType+'_error']+'</p>',modalContent=namePrompt+nameField+nameError;var modal=$.confirm({container:$builder,title:false,content:modalContent,icon:'fa fa-info-circle',type:'blue',buttons:{confirm:{text:wpforms_builder.ok,btnClass:'btn-confirm',keys:['enter'],action:function(){var settingsBlockName=$.trim(this.$content.find('input#settings-block-name').val()),error=this.$content.find('.error');if(settingsBlockName===''){error.show();return false;}else{var $firstSettingsBlock=$el.closest('.wpforms-panel-content-section').find('.wpforms-builder-settings-block').first();wpf.restoreTooltips($firstSettingsBlock);var $newSettingsBlock=$firstSettingsBlock.clone(),blockID=$firstSettingsBlock.data('block-id'),newSettingsBlock;$newSettingsBlock.attr('data-block-id',nextID);$newSettingsBlock.find('.wpforms-builder-settings-block-header span').text(settingsBlockName);$newSettingsBlock.find('input, textarea, select').not('.from-name input').not('.from-email input').each(function(index,el){var $this=$(this);if($this.attr('name')){$this.val('').attr('name',$this.attr('name').replace(/\[(\d+)\]/,'['+nextID+']'));if($this.is('select')){$this.find('option').prop('selected',false).attr('selected',false);$this.find('option:first').prop('selected',true).attr('selected','selected');}else if($this.attr('type')==='checkbox'){$this.prop('checked',false).attr('checked',false).val('1');}else{$this.val('').attr('value','');}}});var idPrefixPanel='wpforms-panel-field-'+panelID+'-',idPrefixBlock=idPrefixPanel+blockID;$newSettingsBlock.find('[id^="'+idPrefixBlock+'"], [for^="'+idPrefixBlock+'"]').each(function(index,el){var $el=$(this),attr=$el.prop('tagName')==='LABEL'?'for':'id',elID=$el.attr(attr).replace(new RegExp(idPrefixBlock,'g'),idPrefixPanel+nextID);$el.attr(attr,elID);});var radioGroup=blockID+'-notification-by-status';$newSettingsBlock.find('[data-radio-group="'+radioGroup+'"]').each(function(index,el){$(this).removeClass('wpforms-radio-group-'+radioGroup).addClass('wpforms-radio-group-'+nextID+'-notification-by-status').attr('data-radio-group',nextID+'-notification-by-status');});$newSettingsBlock.find('.wpforms-builder-settings-block-header input').val(settingsBlockName).attr('value',settingsBlockName);if(blockType==='notification'){$newSettingsBlock.find('.email-msg textarea').val('{all_fields}').attr('value','{all_fields}');$newSettingsBlock.find('.email-recipient input').val('{admin_email}').attr('value','{admin_email}');}
$newSettingsBlock.removeClass('wpforms-builder-settings-block-default');if(blockType==='confirmation'){$newSettingsBlock.find('.wpforms-panel-field-tinymce').remove();if(typeof WPForms!=='undefined'){$newSettingsBlock.find('.wpforms-panel-field-confirmations-type-wrap').after(WPForms.Admin.Builder.Templates.get('wpforms-builder-confirmations-message-field')({id:nextID,}));}}
var $conditionalLogic=$newSettingsBlock.find('.wpforms-conditional-block');if($conditionalLogic.length&&typeof WPForms!=='undefined'){$conditionalLogic.html(WPForms.Admin.Builder.Templates.get('wpforms-builder-conditional-logic-toggle-field')({id:nextID,type:blockType,actions:JSON.stringify($newSettingsBlock.find('.wpforms-panel-field-conditional_logic-checkbox').data('actions')),actionDesc:$newSettingsBlock.find('.wpforms-panel-field-conditional_logic-checkbox').data('action-desc'),}));}
var $fieldsMapTable=$newSettingsBlock.find('.wpforms-field-map-table');if($fieldsMapTable.length){$fieldsMapTable.each(function(index,el){var $table=$(el);$table.find('tr:not(:first-child)').remove();var $input=$table.find('.key input'),$select=$table.find('.field select'),name=$select.data('name');$input.attr('value','');$select.attr('name','').attr('data-name',name.replace(/\[(\d+)\]/,'['+nextID+']'));});}
newSettingsBlock=$newSettingsBlock.wrap('<div>').parent().html();newSettingsBlock=newSettingsBlock.replace(/\[conditionals\]\[(\d+)\]\[(\d+)\]/g,'[conditionals][0][0]');$firstSettingsBlock.before(newSettingsBlock);var $addedSettingBlock=$firstSettingsBlock.prev();if(blockType==='confirmation'){app.confirmationFieldsToggle($('.wpforms-panel-field-confirmations-type').first());}
if(typeof tinymce!=='undefined'&&typeof wp.editor!=='undefined'&&blockType==='confirmation'){wp.editor.initialize('wpforms-panel-field-confirmations-message-'+nextID,s.tinymceDefaults);}
wpf.initTooltips();$builder.trigger('wpformsSettingsBlockAdded',[$addedSettingBlock]);$el.attr('data-next-id',nextID+1);}},},cancel:{text:wpforms_builder.cancel,},},});$builder.on('keypress','#settings-block-name',function(e){if(e.keyCode===13){$(modal.buttons.confirm.el).trigger('click');}});},settingsBlockNameEditingShow:function($el){var header_holder=$el.parents('.wpforms-builder-settings-block-header'),name_holder=header_holder.find('.wpforms-builder-settings-block-name');name_holder.addClass('editing').hide();header_holder.find('.wpforms-builder-settings-block-name-edit').addClass('active');wpf.focusCaretToEnd(header_holder.find('input'));},settingsBlockNameEditingHide:function($el){var header_holder=$el.parents('.wpforms-builder-settings-block-header'),name_holder=header_holder.find('.wpforms-builder-settings-block-name'),edit_holder=header_holder.find('.wpforms-builder-settings-block-name-edit'),current_name=edit_holder.find('input').val().trim(),blockType=$el.closest('.wpforms-builder-settings-block').data('block-type');if(!current_name.length){current_name=wpforms_builder[blockType+'_def_name'];}
edit_holder.find('input').val(current_name);name_holder.text(current_name);name_holder.removeClass('editing').show();edit_holder.removeClass('active');},settingsBlockPanelClone:function($el){var $panel=$el.closest('.wpforms-panel-content-section'),$addNewSettingButton=$panel.find('.wpforms-builder-settings-block-add'),$settingsBlock=$el.closest('.wpforms-builder-settings-block'),$settingBlockContent=$settingsBlock.find('.wpforms-builder-settings-block-content'),settingsBlockId=parseInt($addNewSettingButton.attr('data-next-id'),10),settingsBlockType=$settingsBlock.data('block-type'),settingsBlockName=$settingsBlock.find('.wpforms-builder-settings-block-name').text().trim()+wpforms_builder[settingsBlockType+'_clone'],isVisibleContent=$settingBlockContent.is(':hidden');wpf.restoreTooltips($settingsBlock);var $clone=$settingsBlock.clone(false,true);app.settingsBlockUpdateState(isVisibleContent,settingsBlockId,settingsBlockType);$clone.data('block-id',settingsBlockId);$clone.find('.wpforms-builder-settings-block-header span').text(settingsBlockName);$clone.find('.wpforms-builder-settings-block-header input').val(settingsBlockName);$clone.removeClass('wpforms-builder-settings-block-default');$addNewSettingButton.attr('data-next-id',settingsBlockId+1);$clone.find('input, textarea, select').each(function(){var $this=$(this);if($this.attr('name')){$this.attr('name',$this.attr('name').replace(/\[(\d+)\]/,'['+settingsBlockId+']'));}
if($this.data('name')){$this.data('name',$this.data('name').replace(/\[(\d+)\]/,'['+settingsBlockId+']'));}
if($this.attr('class')){$this.attr('class',$this.attr('class').replace(/-(\d+)/,'-'+settingsBlockId));}
if($this.attr('data-radio-group')){$this.attr('data-radio-group',$this.attr('data-radio-group').replace(/(\d+)-/,settingsBlockId+'-'));}});$clone.find('*').each(function(){var $this=$(this);if($this.attr('id')){$this.attr('id',$this.attr('id').replace(/-(\d+)/,'-'+settingsBlockId));}
if($this.attr('for')){$this.attr('for',$this.attr('for').replace(/-(\d+)-/,'-'+settingsBlockId+'-'));}
if($this.data('input-name')){$this.data('input-name',$this.data('input-name').replace(/\[(\d+)\]/,'['+settingsBlockId+']'));}});$settingsBlock.find('select').each(function(){var baseSelectName=$(this).attr('name'),clonedSelectName=$(this).attr('name').replace(/\[(\d+)\]/,'['+settingsBlockId+']');$clone.find('select[name="'+clonedSelectName+'"]').val($(this).attr('name',baseSelectName).val());});$clone.css('display','none').insertBefore($settingsBlock).show('fast',function(){wpf.initTooltips();});},settingsBlockPanelToggle:function($el){var $settingsBlock=$el.closest('.wpforms-builder-settings-block'),settingsBlockId=$settingsBlock.data('block-id'),settingsBlockType=$settingsBlock.data('block-type'),$content=$settingsBlock.find('.wpforms-builder-settings-block-content'),isVisible=$content.is(':visible');$content.stop().slideToggle({duration:400,start:function(){app.settingsBlockUpdateState(isVisible,settingsBlockId,settingsBlockType);},always:function(){if($content.is(':visible')){$el.html('<i class="fa fa-chevron-circle-up"></i>');}else{$el.html('<i class="fa fa-chevron-circle-down"></i>');}},});},settingsBlockDelete:function($el){var $contentSection=$el.closest('.wpforms-panel-content-section'),$currentBlock=$el.closest('.wpforms-builder-settings-block'),blockType=$currentBlock.data('block-type');if($contentSection.find('.wpforms-builder-settings-block').length<2){return;}
$.confirm({title:false,content:wpforms_builder[blockType+'_delete'],icon:'fa fa-exclamation-circle',type:'orange',buttons:{confirm:{text:wpforms_builder.ok,btnClass:'btn-confirm',keys:['enter'],action:function(){var settingsBlockId=$currentBlock.data('block-id'),settingsBlockType=$currentBlock.data('block-type');$.post(wpforms_builder.ajax_url,{action:'wpforms_builder_settings_block_state_remove',nonce:wpforms_builder.nonce,block_id:settingsBlockId,block_type:settingsBlockType,form_id:s.formID,});$currentBlock.remove();$builder.trigger('wpformsSettingsBlockDeleted',[blockType,settingsBlockId]);},},cancel:{text:wpforms_builder.cancel,},},});},settingsBlockUpdateState:function(isVisible,settingsBlockId,settingsBlockType){$.post(wpforms_builder.ajax_url,{action:'wpforms_builder_settings_block_state_save',state:isVisible?'closed':'opened',form_id:s.formID,block_id:settingsBlockId,block_type:settingsBlockType,nonce:wpforms_builder.nonce,});},bindUIActionsRevisions:function(){$builder.on('wpformsPanelSwitched',function(event,panel){if(panel!=='revisions'){return;}
app.updateRevisionsList();app.updateRevisionPreview();});$builder.on('wpformsSaved',function(event){if(wpf.getQueryString('view')!=='revisions'){return;}
app.updateRevisionsList();});},updateRevisionsList:function(){var $revisionsList=$('#wpforms-panel-revisions .wpforms-revisions-content'),$revisionsButtonBadge=$('.wpforms-panel-revisions-button .badge-exclamation');if($revisionsButtonBadge.length){$.post(wpforms_builder.ajax_url,{action:'wpforms_mark_panel_viewed',form_id:s.formID,nonce:wpforms_builder.nonce,}).done(function(response){response.success?$revisionsButtonBadge.remove():wpf.debug(response);}).fail(function(xhr,textStatus,e){wpf.debug(xhr.responseText||textStatus||'');});}
if(!$builder.hasClass('wpforms-revisions-enabled')){return;}
$revisionsList.fadeTo(250,.25,function(){$.post(wpforms_builder.ajax_url,{action:'wpforms_get_form_revisions',form_id:s.formID,revision_id:wpf.getQueryString('revision_id'),nonce:wpforms_builder.nonce,}).done(function(response){response.success?$revisionsList.replaceWith(response.data.html):wpf.debug(response);}).fail(function(xhr,textStatus,e){wpf.debug(xhr.responseText||textStatus||'');$revisionsList.fadeTo(250,1);});});},updateRevisionPreview:function(){var $preview=elements.$formPreview.clone();$preview.find('.wpforms-field-duplicate, .wpforms-field-delete, .wpforms-field-helper, .wpforms-debug').remove().end();$preview.find('.wpforms-field-wrap').removeClass('ui-sortable').addClass('ui-sortable-disabled');$preview.find('.wpforms-field').removeClass('ui-sortable-handle ui-draggable ui-draggable-handle active').removeAttr('id data-field-id data-field-type').removeData();$preview.find('.wpforms-field-submit-button').prop('disabled',true);if(elements.$revisionPreview.hasClass('has-preview')){elements.$revisionPreview.find('.wpforms-preview-wrap').replaceWith($preview);}else{elements.$revisionPreview.append($preview).addClass('has-preview');}},confirmSaveRevision:function(){$.confirm({title:wpforms_builder.heads_up,content:wpforms_builder.revision_update_confirm,icon:'fa fa-exclamation-circle',type:'orange',closeIcon:false,buttons:{confirm:{text:wpforms_builder.save,btnClass:'btn-confirm',keys:['enter'],action:function(){$builder.addClass('wpforms-revision-is-saving');WPFormsBuilder.formSave(false).done(app.revisionSavedReload);},},cancel:{text:wpforms_builder.cancel,action:function(){WPFormsBuilder.setCloseConfirmation(true);},},},});},revisionSavedReload:function(){wpf.updateQueryString('view',wpf.getQueryString('view'));wpf.removeQueryParam('revision_id');window.location.reload();},bindUIActionsSaveExit:function(){$builder.on('click','#wpforms-embed',function(e){e.preventDefault();if($(this).hasClass('wpforms-disabled')){return;}
WPFormsFormEmbedWizard.openPopup();});$builder.on('click','#wpforms-save',function(e){e.preventDefault();app.formSave(false);});$builder.on('click','#wpforms-exit',function(e){e.preventDefault();app.formExit();});$builder.on('wpformsSaved',function(e,data){wpf.removeQueryParam('newform');});},formSave:function(redirect){var $saveBtn=$('#wpforms-save'),$icon=$saveBtn.find('i.fa-check'),$spinner=$saveBtn.find('i.wpforms-loading-spinner'),$label=$saveBtn.find('span'),text=$label.text();if($builder.hasClass('wpforms-is-revision')&&!$builder.hasClass('wpforms-revision-is-saving')){app.confirmSaveRevision();return;}
if(typeof tinyMCE!=='undefined'){tinyMCE.triggerSave();}
$label.text(wpforms_builder.saving);$icon.addClass('wpforms-hidden');$spinner.removeClass('wpforms-hidden');var data={action:'wpforms_save_form',data:JSON.stringify($('#wpforms-builder-form').serializeArray()),id:s.formID,nonce:wpforms_builder.nonce,};return $.post(wpforms_builder.ajax_url,data,function(response){if(response.success){wpf.savedState=wpf.getFormState('#wpforms-builder-form');wpf.initialSave=false;$builder.trigger('wpformsSaved',response.data);if(true===redirect&&app.isBuilderInPopup()){app.builderInPopupClose('saved');return;}
if(true===redirect){window.location.href=wpforms_builder.exit_url;}}else{wpf.debug(response);app.formSaveError(response.data);}}).fail(function(xhr,textStatus,e){wpf.debug(xhr);app.formSaveError();}).always(function(){$label.text(text);$spinner.addClass('wpforms-hidden');$icon.removeClass('wpforms-hidden');});},formSaveError:function(error){if(wpf.empty(error)){error=wpforms_builder.error_save_form;}
$.confirm({title:wpforms_builder.heads_up,content:'<p>'+error+'</p><p>'+wpforms_builder.error_contact_support+'</p>',icon:'fa fa-exclamation-circle',type:'orange',buttons:{confirm:{text:wpforms_builder.ok,btnClass:'btn-confirm',keys:['enter'],},},});},formExit:function(){if(app.isBuilderInPopup()&&app.formIsSaved()){app.builderInPopupClose('saved');return;}
if(app.formIsSaved()){window.location.href=wpforms_builder.exit_url;}else{$.confirm({title:false,content:wpforms_builder.exit_confirm,icon:'fa fa-exclamation-circle',type:'orange',closeIcon:true,buttons:{confirm:{text:wpforms_builder.save_exit,btnClass:'btn-confirm',keys:['enter'],action:function(){app.formSave(true);}},cancel:{text:wpforms_builder.exit,action:function(){closeConfirmation=false;if(app.isBuilderInPopup()){app.builderInPopupClose('canceled');return;}
window.location.href=wpforms_builder.exit_url;}}}});}},setCloseConfirmation:function(confirm){closeConfirmation=!!confirm;},formIsSaved:function(){if(wpf.savedState==wpf.getFormState('#wpforms-builder-form')){return true;}else{return false;}},isBuilderInPopup:function(){return window.self!==window.parent&&window.self.frameElement.id==='wpforms-builder-iframe';},builderInPopupClose:function(action){var $popup=window.parent.jQuery('#wpforms-builder-elementor-popup');$popup.find('#wpforms-builder-iframe').attr('src','about:blank');$popup.fadeOut();$popup.trigger('wpformsBuilderInPopupClose',[action,s.formID]);},bindUIActionsGeneral:function(){$builder.on('click','.toggle-smart-tag-display',app.smartTagToggle);$builder.on('click','.smart-tags-list-display a',app.smartTagInsert);$builder.on('click','.wpforms-panel-fields-group.unfoldable .wpforms-panel-fields-group-title',app.toggleUnfoldableGroup);$builder.on('click','.wpforms-field-helper-hide ',app.hideFieldHelper);$builder.on('input','.wpforms-field-map-table .key-source',function(){var value=$(this).val(),$dest=$(this).parent().parent().find('.key-destination'),name=$dest.data('name');if(value){$dest.attr('name',name.replace('{source}',value.replace(/[^0-9a-zA-Z_-]/gi,'')));}});$builder.on('click','.wpforms-field-map-table .remove',function(e){e.preventDefault();app.fieldMapTableDeleteRow(e,$(this));});$builder.on('click','.wpforms-field-map-table .add',function(e){e.preventDefault();app.fieldMapTableAddRow(e,$(this));});$(document).on('wpformsFieldUpdate',app.fieldMapSelect);$builder.on('input','.wpforms-money-input',function(event){var $this=$(this),amount=$this.val(),start=$this[0].selectionStart,end=$this[0].selectionEnd;$this.val(amount.replace(/[^0-9.,]/g,''));$this[0].setSelectionRange(start,end);});$builder.on('focusout','.wpforms-money-input',function(event){var $this=$(this),amount=$this.val();if(!amount){return amount;}
var sanitized=wpf.amountSanitize(amount),formatted=wpf.amountFormat(sanitized);$this.val(formatted);});$builder.on('change','.wpforms-panel-field-toggle',function(){var $input=$(this);if($input.prop('disabled')){return;}
$input.prop('disabled',true);app.toggleOptionsGroup($input);});$builder.on('change','#wpforms-panel-field-stripe-enable, #wpforms-panel-field-paypal_standard-enable, #wpforms-panel-field-authorize_net-enable, #wpforms-panel-field-square-enable',function(event){var $this=$(this),gateway=$this.attr('id').replace('wpforms-panel-field-','').replace('-enable',''),$notificationWrap=$('.wpforms-panel-content-section-notifications [id*="-'+gateway+'-wrap"]');if($this.prop('checked')){var disabled=$('#wpforms-panel-field-settings-disable_entries').prop('checked');if(disabled){$.confirm({title:wpforms_builder.heads_up,content:wpforms_builder.payments_entries_off,icon:'fa fa-exclamation-circle',type:'orange',buttons:{confirm:{text:wpforms_builder.ok,btnClass:'btn-confirm',keys:['enter'],},},});$this.prop('checked',false);}else{$notificationWrap.removeClass('wpforms-hidden');}}else{$notificationWrap.addClass('wpforms-hidden');$notificationWrap.find('input[id*="-'+gateway+'"]').prop('checked',false);}});$builder.on('change','#wpforms-panel-field-settings-disable_entries',function(event){var $this=$(this);if($this.prop('checked')){var paymentsEnabled=$('#wpforms-panel-field-stripe-enable').prop('checked')||$('#wpforms-panel-field-paypal_standard-enable').prop('checked')||$('#wpforms-panel-field-authorize_net-enable').prop('checked')||$('#wpforms-panel-field-square-enable').prop('checked');if(paymentsEnabled){$.confirm({title:wpforms_builder.heads_up,content:wpforms_builder.payments_on_entries_off,icon:'fa fa-exclamation-circle',type:'orange',buttons:{confirm:{text:wpforms_builder.ok,btnClass:'btn-confirm',keys:['enter'],},},});$this.prop('checked',false);}else{$.alert({title:wpforms_builder.heads_up,content:wpforms_builder.disable_entries,icon:'fa fa-exclamation-circle',type:'orange',buttons:{confirm:{text:wpforms_builder.ok,btnClass:'btn-confirm',keys:['enter'],},},});}}});$builder.on('click','.wpforms-image-upload-add',function(event){event.preventDefault();var $this=$(this),$container=$this.parent(),mediaModal;mediaModal=wp.media.frames.wpforms_media_frame=wp.media({className:'media-frame wpforms-media-frame',frame:'select',multiple:false,title:wpforms_builder.upload_image_title,library:{type:'image',},button:{text:wpforms_builder.upload_image_button,},});mediaModal.on('select',function(){var mediaAttachment=mediaModal.state().get('selection').first().toJSON();$container.find('.source').val(mediaAttachment.url);$container.find('.preview').empty();$container.find('.preview').prepend('<img src="'+mediaAttachment.url+'"><a href="#" title="'+wpforms_builder.upload_image_remove+'" class="wpforms-image-upload-remove"><i class="fa fa-trash-o"></i></a>');if($this.data('after-upload')==='hide'){$this.hide();}
$builder.trigger('wpformsImageUploadAdd',[$this,$container]);});mediaModal.open();});$builder.on('click','.wpforms-image-upload-remove',function(event){event.preventDefault();var $container=$(this).parent().parent();$container.find('.preview').empty();$container.find('.wpforms-image-upload-add').show();$container.find('.source').val('');$builder.trigger('wpformsImageUploadRemove',[$(this),$container]);});$builder.on('blur','.wpforms-notification .wpforms-panel-field-text input',function(){app.validateEmailSmartTags($(this));});$builder.on('blur','.wpforms-notification .wpforms-panel-field-textarea textarea',function(){app.validateEmailSmartTags($(this));});$builder.on('click','.wpforms-fullscreen-notice-go-back',app.exitBack);$('#wpforms-builder-license-alert .close').on('click',app.exitBack);},toggleOptionsGroup:function($input){var name=$input.attr('name'),type=$input.attr('type'),value='',$body=$('.wpforms-panel-field-toggle-body[data-toggle="'+name+'"]'),enableInput=function(){$input.prop('disabled',false);};if($body.length===0){enableInput();return;}
if('checkbox'===type||'radio'===type){value=$input.prop('checked')?$input.val():'0';}else{value=$input.val();}
$body.each(function(){var $this=$(this);$this.attr('data-toggle-value').toString()===value.toString()?$this.slideDown('',enableInput):$this.slideUp('',enableInput);});},toggleAllOptionGroups:function($context){$context=$context||$builder||$('#wpforms-builder')||$('body');if(!$context){return;}
$context.find('.wpforms-panel-field-toggle').each(function(){var $input=$(this);$input.prop('disabled',true);app.toggleOptionsGroup($input);});},toggleUnfoldableGroup:function(e){e.preventDefault();var $title=$(e.target),$group=$title.closest('.wpforms-panel-fields-group'),$inner=$group.find('.wpforms-panel-fields-group-inner'),cookieName='wpforms_fields_group_'+$group.data('group');if($group.hasClass('opened')){wpCookies.remove(cookieName);$group.removeClass('opened');$inner.stop().slideUp();}else{wpCookies.set(cookieName,'true',2592000);$group.addClass('opened');$inner.stop().slideDown();}},hideFieldHelper:function(e){e.preventDefault();e.stopPropagation();var $helpers=$('.wpforms-field-helper'),cookieName='wpforms_field_helper_hide';wpCookies.set(cookieName,'true',30*24*60*60);$helpers.hide();},smartTagToggle:function(e){e.preventDefault();var $this=$(this),$wrapper=$this.closest('.wpforms-panel-field,.wpforms-field-option-row');if($wrapper.hasClass('smart-tags-toggling')){return;}
$wrapper.addClass('smart-tags-toggling');if($this.hasClass('smart-tag-showing')){app.removeSmartTagsList($this);return;}
app.insertSmartTagsList($this);},removeSmartTagsList:function($el){var $wrapper=$el.closest('.wpforms-panel-field,.wpforms-field-option-row'),$list=$wrapper.find('.smart-tags-list-display');$el.find('span').text(wpforms_builder.smart_tags_show);$list.slideUp('',function(){$list.remove();$el.removeClass('smart-tag-showing');$wrapper.removeClass('smart-tags-toggling');});},insertSmartTagsList:function($el){var $wrapper=$el.closest('.wpforms-panel-field,.wpforms-field-option-row'),$label=$el.closest('label'),insideLabel=true,smartTagList;if(!$label.length){$label=$wrapper.find('label');insideLabel=false;}
smartTagList=app.getSmartTagsList($el,$label.attr('for').indexOf('wpforms-field-option-')!==-1);insideLabel?$label.after(smartTagList):$el.after(smartTagList);$el.find('span').text(wpforms_builder.smart_tags_hide);$wrapper.find('.smart-tags-list-display').slideDown('',function(){$el.addClass('smart-tag-showing');$wrapper.removeClass('smart-tags-toggling');});},getSmartTagsList:function($el,isFieldOption){var smartTagList;smartTagList='<ul class="smart-tags-list-display unfoldable-cont">';smartTagList+=app.getSmartTagsListFieldsElements($el);smartTagList+=app.getSmartTagsListOtherElements($el,isFieldOption);smartTagList+='</ul>';return smartTagList;},getSmartTagsListFieldsElements:function($el){var type=$el.data('type'),fields=app.getSmartTagsFields($el),smartTagListElements='';if(!['fields','all'].includes(type)){return '';}
if(!fields){return '<li class="heading">'+wpforms_builder.fields_unavailable+'</li>';}
smartTagListElements+='<li class="heading">'+wpforms_builder.fields_available+'</li>';for(var fieldKey in wpf.orders.fields){var fieldId=wpf.orders.fields[fieldKey];if(!fields[fieldId]){continue;}
smartTagListElements+=app.getSmartTagsListFieldsElement(fields[fieldId]);}
return smartTagListElements;},getSmartTagsFields:function($el){var allowed=$el.data('fields');return allowed&&allowed.length?wpf.getFields(allowed.split(','),true):wpf.getFields(false,true);},getSmartTagsListFieldsElement:function(field){var label=field.label?wpf.encodeHTMLEntities(wpf.sanitizeHTML(field.label)):wpforms_builder.field+' #'+field.id;return '<li><a href="#" data-type="field" data-meta=\''+field.id+'\'>'+label+'</a></li>';},getSmartTagsListOtherElements:function($el,isFieldOption){var type=$el.data('type'),smartTagListElements;if(type!=='other'&&type!=='all'){return '';}
smartTagListElements='<li class="heading">'+wpforms_builder.other+'</li>';for(var smartTagKey in wpforms_builder.smart_tags){if(isFieldOption&&wpforms_builder.smart_tags_disabled_for_fields.indexOf(smartTagKey)>-1){continue;}
smartTagListElements+='<li><a href="#" data-type="other" data-meta=\''+smartTagKey+'\'>'+wpforms_builder.smart_tags[smartTagKey]+'</a></li>';}
return smartTagListElements;},smartTagInsert:function(e){e.preventDefault();var $this=$(this),$list=$this.closest('.smart-tags-list-display'),$wrapper=$list.closest('.wpforms-panel-field,.wpforms-field-option-row'),$toggle=$wrapper.find('.toggle-smart-tag-display'),$input=$wrapper.find('input[type=text], textarea'),meta=$this.data('meta'),type=$this.data('type'),smartTag=type==='field'?'{field_id="'+meta+'"}':'{'+meta+'}',editor;if(typeof tinyMCE!=='undefined'){editor=tinyMCE.get($input.prop('id'));if(editor&&!editor.hasFocus()){editor.focus(true);}}
editor&&!editor.isHidden()?editor.insertContent(smartTag):$input.insertAtCaret(smartTag);$list.slideUp('',function(){$list.remove();});$toggle.find('span').text(wpforms_builder.smart_tags_show);$wrapper.find('.toggle-smart-tag-display').removeClass('smart-tag-showing');},fieldMapTableDeleteRow:function(e,el){var $this=$(el),$row=$this.closest('tr'),$table=$this.closest('table'),$block=$row.closest('.wpforms-builder-settings-block'),total=$table.find('tr').length;if(total>'1'){$row.remove();$builder.trigger('wpformsFieldMapTableDeletedRow',[$block]);}},fieldMapTableAddRow:function(e,el){var $this=$(el),$row=$this.closest('tr'),$block=$row.closest('.wpforms-builder-settings-block'),choice=$row.clone().insertAfter($row);choice.find('input').val('');choice.find('select :selected').prop('selected',false);choice.find('.key-destination').attr('name','');$builder.trigger('wpformsFieldMapTableAddedRow',[$block,choice]);},fieldMapSelect:function(e,fields){$('.wpforms-field-map-select').each(function(index,el){var $this=$(this),selected=$this.find('option:selected').val(),allowedFields=$this.data('field-map-allowed'),placeholder=$this.data('field-map-placeholder');if(typeof placeholder==='undefined'||!placeholder){placeholder=wpforms_builder.select_field;}
$this.empty().append($('<option>',{value:'',text:placeholder}));if(typeof allowedFields!=='undefined'&&allowedFields){allowedFields=allowedFields.split(' ');}else{return;}
if(fields&&!$.isEmptyObject(fields)){for(var key in wpf.orders.fields){if(!Object.prototype.hasOwnProperty.call(wpf.orders.fields,key)){continue;}
var fieldID=wpf.orders.fields[key],label='';if(!fields[fieldID]){continue;}
if(typeof fields[fieldID].label!=='undefined'&&fields[fieldID].label.toString().trim()!==''){label=wpf.sanitizeHTML(fields[fieldID].label.toString().trim());}else{label=wpforms_builder.field+' #'+fieldID;}
if($.inArray(fields[fieldID].type,allowedFields)>=0||$.inArray('all-fields',allowedFields)>=0){$this.append($('<option>',{value:fields[fieldID].id,text:label}));}}}
if(selected){$this.find('option[value="'+selected+'"]').prop('selected',true);}
var customValueSupport=$this.data('custom-value-support');if(typeof customValueSupport==='boolean'&&customValueSupport){$this.append($('<option>',{value:'custom_value',text:wpforms_builder.add_custom_value_label,class:'wpforms-field-map-option-custom-value',}));}
$builder.trigger('wpformsFieldSelectMapped',[$this]);});},validateEmailSmartTags:function($el){var val=$el.val();if(!val){return;}
val=val.replace(/{(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))}/g,function(x){return x.slice(1,-1);});$el.val(val);},dismissNotice:function(){$builder.on('click','.wpforms-alert-dismissible .wpforms-dismiss-button',function(e){e.preventDefault();var $button=$(this),$alert=$button.closest('.wpforms-alert'),fieldId=$button.data('field-id');$alert.addClass('out');setTimeout(function(){$alert.remove();},250);if(fieldId){$('#wpforms-field-option-'+fieldId).remove();}});},trimFormTitle:function(){var $title=$('.wpforms-center-form-name');if($title.text().length>38){var shortTitle=$.trim($title.text()).substring(0,38).split(' ').slice(0,-1).join(' ')+'...';$title.text(shortTitle);}},loadColorPickers:function(){$('.wpforms-color-picker').minicolors();},builderHotkeys:function(){$(document).keydown(function(e){if(!e.ctrlKey){return;}
switch(e.keyCode){case 72:$('#wpforms-help',$builder).click();break;case 80:window.open(wpforms_builder.preview_url);break;case 66:$('#wpforms-embed',$builder).click();break;case 69:window.open(wpforms_builder.entries_url);break;case 83:$('#wpforms-save',$builder).click();break;case 81:$('#wpforms-exit',$builder).click();break;case 191:app.openKeyboardShortcutsModal();break;default:return;}
return false;});},openKeyboardShortcutsModal:function(){if($('.wpforms-builder-keyboard-shortcuts').length){jconfirm.instances[jconfirm.instances.length-1].close();return;}
$.alert({title:wpforms_builder.shortcuts_modal_title,content:wpforms_builder.shortcuts_modal_msg+wp.template('wpforms-builder-keyboard-shortcuts')(),icon:'fa fa-keyboard-o',type:'blue',boxWidth:'550px',smoothContent:false,buttons:{confirm:{text:wpforms_builder.close,btnClass:'btn-confirm',keys:['enter'],},},onOpenBefore:function(){this.$body.addClass('wpforms-builder-keyboard-shortcuts');},});},registerTemplates:function(){if(typeof WPForms==='undefined'){return;}
WPForms.Admin.Builder.Templates.add(['wpforms-builder-confirmations-message-field','wpforms-builder-conditional-logic-toggle-field']);},exitBack:function(){if(1<window.history.length&&document.referrer){window.history.back();}else{window.location.href=wpforms_builder.exit_url;}},};return app;}(document,window,jQuery));WPFormsBuilder.init();