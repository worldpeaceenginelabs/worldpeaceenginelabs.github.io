'use strict';var WPFormsChallenge=window.WPFormsChallenge||{};WPFormsChallenge.core=window.WPFormsChallenge.core||(function(document,window,$){var app={};var vars={};var el={};var timer={initialSecondsLeft:WPFormsChallenge.admin.l10n.minutes_left*60,loadId:function(){return localStorage.getItem('wpformsChallengeTimerId');},saveId:function(id){localStorage.setItem('wpformsChallengeTimerId',id);},run:function(secondsLeft){if(5===app.loadStep()){return;}
var timerId=setInterval(function(){app.updateTimerUI(secondsLeft);secondsLeft--;if(0>secondsLeft){timer.saveSecondsLeft(0);clearInterval(timerId);}},1000);timer.saveId(timerId);return timerId;},pause:function(){var timerId;var elSeconds;var secondsLeft=timer.getSecondsLeft();if(0===secondsLeft||5===app.loadStep()){return;}
timerId=timer.loadId();clearInterval(timerId);elSeconds=$('#wpforms-challenge-timer').data('seconds-left');if(elSeconds){timer.saveSecondsLeft(elSeconds);}},resume:function(){var timerId;var secondsLeft=timer.getSecondsLeft();if(0===secondsLeft||5===app.loadStep()){return;}
timerId=timer.loadId();if(timerId){clearInterval(timerId);}
timer.run(secondsLeft);},clear:function(){localStorage.removeItem('wpformsChallengeSecondsLeft');localStorage.removeItem('wpformsChallengeTimerId');localStorage.removeItem('wpformsChallengeTimerStatus');$('#wpforms-challenge-timer').removeData('seconds-left');},getSecondsLeft:function(){var secondsLeft=localStorage.getItem('wpformsChallengeSecondsLeft');secondsLeft=parseInt(secondsLeft,10)||0;return secondsLeft;},getSecondsSpent:function(secondsLeft){secondsLeft=secondsLeft||timer.getSecondsLeft();return timer.initialSecondsLeft-secondsLeft;},saveSecondsLeft:function(secondsLeft){localStorage.setItem('wpformsChallengeSecondsLeft',secondsLeft);},getMinutesFormatted:function(secondsLeft){secondsLeft=secondsLeft||timer.getSecondsLeft();return Math.floor(secondsLeft/60);},getSecondsFormatted:function(secondsLeft){secondsLeft=secondsLeft||timer.getSecondsLeft();return secondsLeft%60;},getFormatted:function(secondsLeft){secondsLeft=secondsLeft||timer.getSecondsLeft();var timerMinutes=timer.getMinutesFormatted(secondsLeft);var timerSeconds=timer.getSecondsFormatted(secondsLeft);return timerMinutes+(9<timerSeconds?':':':0')+timerSeconds;},};app={timer:timer,init:function(){$(app.ready);$(window).on('load',function(){if(typeof $.ready.then==='function'){$.ready.then(app.load);}else{app.load();}});},ready:function(){app.setup();app.events();},load:function(){if(wpforms_challenge_admin.option.status==='started'){app.timer.run(app.timer.getSecondsLeft());}},setup:function(){var secondsLeft;var timerId=app.timer.loadId();if(timerId){clearInterval(timerId);secondsLeft=app.timer.getSecondsLeft();}
if(!timerId||0===app.loadStep()||wpforms_challenge_admin.option.status==='inited'){secondsLeft=app.timer.initialSecondsLeft;}
app.initElements();app.refreshStep();app.initListUI(null,true);app.updateListUI();app.updateTimerUI(secondsLeft);},events:function(){$([window,document]).on('blur',app.pauseChallenge).on('focus',app.resumeChallenge).on('click','.wpforms-challenge-done-btn',app.resumeChallenge);el.$btnPause.on('click',app.pauseChallenge);el.$btnResume.on('click',app.resumeChallenge);el.$listSteps.on('click','.wpforms-challenge-item-current',app.refreshPage);},initElements:function(){el={$challenge:$('.wpforms-challenge'),$btnPause:$('.wpforms-challenge-pause'),$btnResume:$('.wpforms-challenge-resume'),$listSteps:$('.wpforms-challenge-list'),$listBlock:$('.wpforms-challenge-list-block'),$listBtnToggle:$('.wpforms-challenge-list-block .toggle-list'),$progressBar:$('.wpforms-challenge-bar'),$tooltipBtnDone:function(){return $('.wpforms-challenge-tooltip .wpforms-challenge-done-btn');},};},loadStep:function(){var step=localStorage.getItem('wpformsChallengeStep');step=parseInt(step,10)||0;return step;},saveStep:function(step){localStorage.setItem('wpformsChallengeStep',step);return WPFormsChallenge.admin.saveChallengeOption({step:step});},refreshStep:function(){var savedStep=el.$challenge.data('wpforms-challenge-saved-step');savedStep=parseInt(savedStep,10)||0;if(app.loadStep()!==savedStep){app.saveStep(savedStep);}},stepCompleted:function(step){app.updateListUI(step);app.updateTooltipUI(step);return app.saveStep(step);},initTooltips:function(step,anchor,args){if(typeof $.fn.tooltipster==='undefined'){return;}
var $dot=$('<span class="wpforms-challenge-dot wpforms-challenge-dot-step'+step+'" data-wpforms-challenge-step="'+step+'">&nbsp;</span>');var tooltipsterArgs={content:$('#tooltip-content'+step),trigger:null,interactive:true,animationDuration:0,delay:0,theme:['tooltipster-default','wpforms-challenge-tooltip'],side:['top'],distance:3,functionReady:function(instance,helper){$(helper.tooltip).addClass('wpforms-challenge-tooltip-step'+step);if(step===4||step===3){instance.option('side','right');}
instance.reposition();},};if(typeof args==='object'&&args!==null){$.extend(tooltipsterArgs,args);}
$dot.insertAfter(anchor).tooltipster(tooltipsterArgs);},updateTooltipUI:function(step){var nextStep;step=step||app.loadStep();nextStep=step+1;$('.wpforms-challenge-dot').each(function(i,el){var $dot=$(el),elStep=$dot.data('wpforms-challenge-step');if(elStep<nextStep){$dot.addClass('wpforms-challenge-dot-completed');}
if(elStep>nextStep){$dot.addClass('wpforms-challenge-dot-next');}
if(elStep===nextStep){$dot.removeClass('wpforms-challenge-dot-completed wpforms-challenge-dot-next');}
setTimeout(function(){if($dot.is(':visible')&&elStep===nextStep){$dot.tooltipster('open');}else{$dot.tooltipster('close');}},0);});},initListUI:function(status,initial){status=status||wpforms_challenge_admin.option.status;if(['started','paused'].indexOf(status)>-1){el.$listBlock.find('p').hide();el.$listBtnToggle.show();el.$progressBar.show();var $skipBtn=el.$listBlock.find('.list-block-button.challenge-skip');$skipBtn.attr('title',$skipBtn.data('cancel-title')).removeClass('challenge-skip').addClass('challenge-cancel');}
if(initial&&(($(window).height()<900&&wpforms_challenge_admin.option.window_closed==='')||wpforms_challenge_admin.option.window_closed==='1')){el.$listBlock.find('p').hide();el.$listBtnToggle.trigger('click');}
if(status==='paused'){el.$challenge.addClass('paused');el.$btnPause.hide();el.$btnResume.show();}else{setTimeout(function(){el.$btnPause.show();},0);el.$challenge.removeClass('paused');el.$btnResume.hide();}},updateListUI:function(step){step=step||app.loadStep();el.$listSteps.find('li:lt('+step+')').addClass('wpforms-challenge-item-completed');el.$listSteps.find('li:eq('+step+')').addClass('wpforms-challenge-item-current');el.$progressBar.find('div').css('width',(step*20)+'%');},updateTimerUI:function(secondsLeft){if(!secondsLeft||isNaN(secondsLeft)||'0'===secondsLeft){secondsLeft=0;}
app.timer.saveSecondsLeft(secondsLeft);$('#wpforms-challenge-timer').text(app.timer.getFormatted(secondsLeft)).data('seconds-left',secondsLeft);},removeChallengeUI:function(){$('.wpforms-challenge-dot').remove();el.$challenge.remove();},clearLocalStorage:function(){localStorage.removeItem('wpformsChallengeStep');app.timer.clear();},pauseChallenge:function(e){if(document.activeElement.tagName==='IFRAME'){return;}
if(wpforms_challenge_admin.option.status!=='started'){return;}
vars.pauseEvent=e.type;app.pauseResumeChallenge('pause');},resumeChallenge:function(e){if(wpforms_challenge_admin.option.status!=='paused'){return;}
if(e.type==='focus'&&vars.pauseEvent!=='blur'){delete vars.pauseEvent;return;}
vars.resumeEvent=e.type;app.pauseResumeChallenge('resume');},pauseResumeChallenge:function(action){action=action==='pause'?action:'resume';app.timer[action]();var optionData={status:action==='pause'?'paused':'started',seconds_spent:app.timer.getSecondsSpent(),seconds_left:app.timer.getSecondsLeft(),};WPFormsChallenge.admin.saveChallengeOption(optionData);app.initListUI(optionData.status);},refreshPage:function(e){window.location.reload(true);},isGutenberg:function(){return typeof wp!=='undefined'&&Object.prototype.hasOwnProperty.call(wp,'blocks');},triggerPageSave:function(){if(app.isGutenberg()){app.gutenbergPageSave();}else{$('#post #publish').trigger('click');}},gutenbergPageSave:function(){var $gb=$('.block-editor'),$updateBtn=$gb.find('.editor-post-publish-button.editor-post-publish-button__button');if($updateBtn.length>0){$updateBtn.trigger('click');return;}
var obs={targetNode:$gb.find('.edit-post-layout, .block-editor-editor-skeleton__publish > div')[0],config:{childList:true,attributes:true,subtree:true,},};obs.callback=function(mutationsList,observer){var $btn=$gb.find('.editor-post-publish-button, .editor-post-publish-panel__header-publish-button .editor-post-publish-button__button');if($btn.length>0){$btn.trigger('click');observer.disconnect();}};obs.observer=new MutationObserver(obs.callback);obs.observer.observe(obs.targetNode,obs.config);$gb.find('.edit-post-toggle-publish-panel__button, .editor-post-publish-panel__toggle.editor-post-publish-button__button').trigger('click');},};return app;}(document,window,jQuery));WPFormsChallenge.core.init();