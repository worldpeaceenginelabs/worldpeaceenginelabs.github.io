'use strict';var WPFormsFormEmbedWizard=window.WPFormsFormEmbedWizard||(function(document,window,$){var el={};var vars={formId:0,isBuilder:false,isChallengeActive:false,};var app={init:function(){$(app.ready);$(window).on('load',function(){if(typeof $.ready.then==='function'){$.ready.then(app.load);}else{app.load();}});},ready:function(){app.initVars();app.events();},load:function(){if(wpforms_admin_form_embed_wizard.is_edit_page==='1'&&!vars.isChallengeActive){app.initTooltip();}
if(vars.isBuilder){app.initialStateToggle();}},initVars:function(){el={$wizardContainer:$('#wpforms-admin-form-embed-wizard-container'),$wizard:$('#wpforms-admin-form-embed-wizard'),$contentInitial:$('#wpforms-admin-form-embed-wizard-content-initial'),$contentSelectPage:$('#wpforms-admin-form-embed-wizard-content-select-page'),$contentCreatePage:$('#wpforms-admin-form-embed-wizard-content-create-page'),$sectionBtns:$('#wpforms-admin-form-embed-wizard-section-btns'),$sectionGo:$('#wpforms-admin-form-embed-wizard-section-go'),$newPageTitle:$('#wpforms-admin-form-embed-wizard-new-page-title'),$selectPage:$('#wpforms-admin-form-embed-wizard-select-page'),$videoTutorial:$('#wpforms-admin-form-embed-wizard-tutorial'),$sectionToggles:$('#wpforms-admin-form-embed-wizard-section-toggles'),$sectionGoBack:$('#wpforms-admin-form-embed-wizard-section-goback'),$shortcode:$('#wpforms-admin-form-embed-wizard-shortcode-wrap'),$shortcodeInput:$('#wpforms-admin-form-embed-wizard-shortcode'),$shortcodeCopy:$('#wpforms-admin-form-embed-wizard-shortcode-copy'),};vars.isBuilder=typeof WPFormsBuilder!=='undefined';vars.isChallengeActive=typeof WPFormsChallenge!=='undefined';vars.pagesExists=el.$wizard.data('pages-exists')===1;},events:function(){if(!el.$wizard.length){return;}
el.$wizard.on('click','button',app.popupButtonsClick).on('click','.tutorial-toggle',app.tutorialToggle).on('click','.shortcode-toggle',app.shortcodeToggle).on('click','.initialstate-toggle',app.initialStateToggle).on('click','.wpforms-admin-popup-close',app.closePopup).on('click','#wpforms-admin-form-embed-wizard-shortcode-copy',app.copyShortcodeToClipboard);},popupButtonsClick:function(e){var $btn=$(e.target);if(!$btn.length){return;}
var $div=$btn.closest('div'),action=$btn.data('action')||'';el.$contentInitial.hide();switch(action){case 'select-page':el.$newPageTitle.hide();el.$contentSelectPage.show();break;case 'create-page':el.$selectPage.hide();el.$contentCreatePage.show();break;case 'go':if(el.$selectPage.is(':visible')&&el.$selectPage.val()===''){return;}
$btn.prop('disabled',true);app.saveFormAndRedirect();return;}
$div.hide();$div.next().fadeIn();el.$sectionToggles.hide();el.$sectionGoBack.fadeIn();app.tutorialControl('Stop');},tutorialToggle:function(e){e.preventDefault();el.$shortcode.hide();el.$videoTutorial.toggle();if(el.$videoTutorial.attr('src')==='about:blank'){el.$videoTutorial.attr('src',wpforms_admin_form_embed_wizard.video_url);}
if(el.$videoTutorial[0].src.indexOf('&autoplay=1')<0){app.tutorialControl('Play');}else{app.tutorialControl('Stop');}},tutorialControl:function(action){var iframe=el.$videoTutorial[0];if(typeof iframe==='undefined'){return;}
if(action!=='Stop'){iframe.src+=iframe.src.indexOf('&autoplay=1')<0?'&autoplay=1':'';}else{iframe.src=iframe.src.replace('&autoplay=1','');}},shortcodeToggle:function(e){e.preventDefault();el.$videoTutorial.hide();app.tutorialControl('Stop');el.$shortcodeInput.val('[wpforms id="'+vars.formId+'" title="false"]');el.$shortcode.toggle();},copyShortcodeToClipboard:function(){el.$shortcodeInput.prop('disabled',false).select().prop('disabled',true);document.execCommand('copy');var $icon=el.$shortcodeCopy.find('i');$icon.removeClass('fa-files-o').addClass('fa-check');window.setTimeout(function(){$icon.removeClass('fa-check').addClass('fa-files-o');},2500);},initialStateToggle:function(e){if(e){e.preventDefault();}
if(vars.pagesExists){el.$contentInitial.show();el.$contentSelectPage.hide();el.$contentCreatePage.hide();el.$selectPage.show();el.$newPageTitle.show();el.$sectionBtns.show();el.$sectionGo.hide();}else{el.$contentInitial.hide();el.$contentSelectPage.hide();el.$contentCreatePage.show();el.$selectPage.hide();el.$newPageTitle.show();el.$sectionBtns.hide();el.$sectionGo.show();}
el.$shortcode.hide();el.$videoTutorial.hide();app.tutorialControl('Stop');el.$sectionToggles.show();el.$sectionGoBack.hide();},saveFormAndRedirect:function(){if(!vars.isBuilder||WPFormsBuilder.formIsSaved()){app.embedPageRedirect();return;}
if(vars.isBuilder&&vars.isChallengeActive){WPFormsBuilder.formSave().done(app.embedPageRedirect);return;}
$.confirm({title:false,content:wpforms_builder.exit_confirm,icon:'fa fa-exclamation-circle',type:'orange',closeIcon:true,buttons:{confirm:{text:wpforms_builder.save_embed,btnClass:'btn-confirm',keys:['enter'],action:function(){WPFormsBuilder.formSave().done(app.embedPageRedirect);},},cancel:{text:wpforms_builder.embed,action:function(){WPFormsBuilder.setCloseConfirmation(false);app.embedPageRedirect();},},},onClose:function(){el.$sectionGo.find('button').prop('disabled',false);},});},embedPageRedirectAjaxData:function(){var data={action:'wpforms_admin_form_embed_wizard_embed_page_url',_wpnonce:wpforms_admin_form_embed_wizard.nonce,formId:vars.formId,};if(el.$selectPage.is(':visible')){data.pageId=el.$selectPage.val();}
if(el.$newPageTitle.is(':visible')){data.pageTitle=el.$newPageTitle.val();}
return data;},embedPageRedirect:function(){var data=app.embedPageRedirectAjaxData();if(typeof data.pageId!=='undefined'&&data.pageId===''){return;}
$.post(ajaxurl,data,function(response){if(response.success){window.location=response.data;}});},openPopup:function(openFormId){openFormId=openFormId||0;vars.formId=vars.isBuilder?$('#wpforms-builder-form').data('id'):openFormId;el.$wizard.toggleClass('wpforms-challenge-popup',vars.isChallengeActive);el.$wizard.find('.wpforms-admin-popup-close').toggle(!vars.isChallengeActive);el.$wizard.find('.wpforms-admin-popup-content-regular').toggle(!vars.isChallengeActive);el.$wizard.find('.wpforms-admin-popup-content-challenge').toggle(vars.isChallengeActive);if(el.$selectPage.length===0){el.$sectionBtns.hide();el.$sectionGo.show();}else{el.$sectionBtns.show();el.$sectionGo.hide();}
el.$newPageTitle.show();el.$selectPage.show();el.$wizardContainer.fadeIn();},closePopup:function(){el.$wizardContainer.fadeOut();app.initialStateToggle();},initTooltip:function(){if(typeof $.fn.tooltipster==='undefined'){return;}
var $dot=$('<span class="wpforms-admin-form-embed-wizard-dot">&nbsp;</span>'),isGutengerg=app.isGutenberg(),anchor=isGutengerg?'.block-editor .edit-post-header':'#wp-content-editor-tools .wpforms-insert-form-button';var tooltipsterArgs={content:$('#wpforms-admin-form-embed-wizard-tooltip-content'),trigger:'custom',interactive:true,animationDuration:0,delay:0,theme:['tooltipster-default','wpforms-admin-form-embed-wizard'],side:isGutengerg?'bottom':'right',distance:3,functionReady:function(instance,helper){instance._$tooltip.on('click','button',function(){instance.close();$('.wpforms-admin-form-embed-wizard-dot').remove();});instance.reposition();},};$dot.insertAfter(anchor).tooltipster(tooltipsterArgs).tooltipster('open');},isGutenberg:function(){return typeof wp!=='undefined'&&Object.prototype.hasOwnProperty.call(wp,'blocks');},};return app;}(document,window,jQuery));WPFormsFormEmbedWizard.init();